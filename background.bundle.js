(()=>{var e={757:(e,t,r)=>{e.exports=r(666)},624:(e,t,r)=>{var n;n=function(){var e,t,n;return function e(t,r,n){function o(a,s){if(!r[a]){if(!t[a]){var c="function"==typeof _dereq_&&_dereq_;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=r[a]={exports:{}};t[a][0].call(u.exports,(function(e){var r=t[a][1][e];return o(r||e)}),u,u.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof _dereq_&&_dereq_,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){"use strict";t.exports=function(e){var t=e._SomePromiseArray;function r(e){var r=new t(e),n=r.promise();return r.setHowMany(1),r.setUnwrap(),r.init(),n}e.any=function(e){return r(e)},e.prototype.any=function(){return r(this)}}},{}],2:[function(e,t,r){"use strict";var n;try{throw new Error}catch(e){n=e}var o=e("./schedule"),i=e("./queue");function a(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new i(16),this._normalQueue=new i(16),this._haveDrainedQueues=!1;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=o}function s(e){for(;e.length()>0;)c(e)}function c(e){var t=e.shift();if("function"!=typeof t)t._settlePromises();else{var r=e.shift(),n=e.shift();t.call(r,n)}}a.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},a.prototype.hasCustomScheduler=function(){return this._customScheduler},a.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},a.prototype.fatalError=function(e,t){t?(process.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),process.exit(2)):this.throwLater(e)},a.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout((function(){e(t)}),0);else try{this._schedule((function(){e(t)}))}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},a.prototype.invokeLater=function(e,t,r){this._lateQueue.push(e,t,r),this._queueTick()},a.prototype.invoke=function(e,t,r){this._normalQueue.push(e,t,r),this._queueTick()},a.prototype.settlePromises=function(e){this._normalQueue._pushOne(e),this._queueTick()},a.prototype._drainQueues=function(){s(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,s(this._lateQueue)},a.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},a.prototype._reset=function(){this._isTickUsed=!1},t.exports=a,t.exports.firstLineError=n},{"./queue":26,"./schedule":29}],3:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){var o=!1,i=function(e,t){this._reject(t)},a=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(i,i,null,this,e)},s=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},c=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(i){o||(o=!0,e.prototype._propagateFrom=n.propagateFromFunction(),e.prototype._boundValue=n.boundValueFunction());var l=r(i),u=new e(t);u._propagateFrom(this,1);var p=this._target();if(u._setBoundTo(l),l instanceof e){var f={promiseRejectionQueued:!1,promise:u,target:p,bindingPromise:l};p._then(t,a,void 0,u,f),l._then(s,c,void 0,u,f),u._setOnCancel(l)}else u._resolveCallback(p);return u},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,r){return e.resolve(r).bind(t)}}},{}],4:[function(e,t,r){"use strict";var n;"undefined"!=typeof Promise&&(n=Promise);var o=e("./promise")();o.noConflict=function(){try{Promise===o&&(Promise=n)}catch(e){}return o},t.exports=o},{"./promise":22}],5:[function(e,t,r){"use strict";var n=Object.create;if(n){var o=n(null),i=n(null);o[" size"]=i[" size"]=0}t.exports=function(t){var r=e("./util"),n=r.canEvaluate;function o(e){var n=function(e,n){var o;if(null!=e&&(o=e[n]),"function"!=typeof o){var i="Object "+r.classString(e)+" has no method '"+r.toString(n)+"'";throw new t.TypeError(i)}return o}(e,this.pop());return n.apply(e,this)}function i(e){return e[this]}function a(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}r.isIdentifier,t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(o,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t;if("number"==typeof e)t=a;else if(n){var r=(void 0)(e);t=null!==r?r:i}else t=i;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t,r){"use strict";t.exports=function(t,r,n,o){var i=e("./util"),a=i.tryCatch,s=i.errorObj,c=t._async;t.prototype.break=t.prototype.cancel=function(){if(!o.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var r=e._cancellationParent;if(null==r||!r._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=r}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),c.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(e,t){if(i.isArray(e))for(var r=0;r<e.length;++r)this._doInvokeOnCancel(e[r],t);else if(void 0!==e)if("function"==typeof e){if(!t){var n=a(e).call(this._boundValue());n===s&&(this._attachExtraTrace(n.e),c.throwLater(n.e))}}else e._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),c.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,r){"use strict";t.exports=function(t){var r=e("./util"),n=e("./es5").keys,o=r.tryCatch,i=r.errorObj;return function(e,a,s){return function(c){var l=s._boundValue();e:for(var u=0;u<e.length;++u){var p=e[u];if(p===Error||null!=p&&p.prototype instanceof Error){if(c instanceof p)return o(a).call(l,c)}else if("function"==typeof p){var f=o(p).call(l,c);if(f===i)return f;if(f)return o(a).call(l,c)}else if(r.isObject(c)){for(var h=n(p),d=0;d<h.length;++d){var y=h[d];if(p[y]!=c[y])continue e}return o(a).call(l,c)}}return t}}}},{"./es5":13,"./util":36}],8:[function(e,t,r){"use strict";t.exports=function(e){var t=!1,r=[];function n(){this._trace=new n.CapturedTrace(o())}function o(){var e=r.length-1;if(e>=0)return r[e]}return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},n.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,r.push(this._trace))},n.prototype._popContext=function(){if(void 0!==this._trace){var e=r.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},n.CapturedTrace=null,n.create=function(){if(t)return new n},n.deactivateLongStackTraces=function(){},n.activateLongStackTraces=function(){var r=e.prototype._pushContext,i=e.prototype._popContext,a=e._peekContext,s=e.prototype._peekContext,c=e.prototype._promiseCreated;n.deactivateLongStackTraces=function(){e.prototype._pushContext=r,e.prototype._popContext=i,e._peekContext=a,e.prototype._peekContext=s,e.prototype._promiseCreated=c,t=!1},t=!0,e.prototype._pushContext=n.prototype._pushContext,e.prototype._popContext=n.prototype._popContext,e._peekContext=e.prototype._peekContext=o,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},n}},{}],9:[function(e,t,r){"use strict";t.exports=function(t,r,n,o){var i,a,s,c,l=t._async,u=e("./errors").Warning,p=e("./util"),f=e("./es5"),h=p.canAttachTrace,d=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,y=/\((?:timers\.js):\d+:\d+\)/,_=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,g=null,m=null,v=!1,b=!(0==p.env("BLUEBIRD_DEBUG")),w=!(0==p.env("BLUEBIRD_WARNINGS")||!b&&!p.env("BLUEBIRD_WARNINGS")),k=!(0==p.env("BLUEBIRD_LONG_STACK_TRACES")||!b&&!p.env("BLUEBIRD_LONG_STACK_TRACES")),S=0!=p.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(w||!!p.env("BLUEBIRD_W_FORGOTTEN_RETURN"));!function(){var e=[];function r(){for(var t=0;t<e.length;++t)e[t]._notifyUnhandledRejection();n()}function n(){e.length=0}c=function(t){e.push(t),setTimeout(r,1)},f.defineProperty(t,"_unhandledRejectionCheck",{value:r}),f.defineProperty(t,"_unhandledRejectionClear",{value:n})}(),t.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},t.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),c(this))},t.prototype._notifyUnhandledRejectionIsHandled=function(){Q("rejectionHandled",i,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),Q("unhandledRejection",a,e,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(e,t,r){return V(e,t,r||this)},t.onPossiblyUnhandledRejection=function(e){var r=t._getContext();a=p.contextBind(r,e)},t.onUnhandledRejectionHandled=function(e){var r=t._getContext();i=p.contextBind(r,e)};var E=function(){};t.longStackTraces=function(){if(l.haveItemsQueued()&&!te.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!te.longStackTraces&&Y()){var e=t.prototype._captureStackTrace,n=t.prototype._attachExtraTrace,o=t.prototype._dereferenceTrace;te.longStackTraces=!0,E=function(){if(l.haveItemsQueued()&&!te.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=n,t.prototype._dereferenceTrace=o,r.deactivateLongStackTraces(),te.longStackTraces=!1},t.prototype._captureStackTrace=q,t.prototype._attachExtraTrace=B,t.prototype._dereferenceTrace=H,r.activateLongStackTraces()}},t.hasLongStackTraces=function(){return te.longStackTraces&&Y()};var C={unhandledrejection:{before:function(){var e=p.global.onunhandledrejection;return p.global.onunhandledrejection=null,e},after:function(e){p.global.onunhandledrejection=e}},rejectionhandled:{before:function(){var e=p.global.onrejectionhandled;return p.global.onrejectionhandled=null,e},after:function(e){p.global.onrejectionhandled=e}}},O=function(){var e=function(e,t){if(!e)return!p.global.dispatchEvent(t);var r;try{return r=e.before(),!p.global.dispatchEvent(t)}finally{e.after(r)}};try{if("function"==typeof CustomEvent){var t=new CustomEvent("CustomEvent");return p.global.dispatchEvent(t),function(t,r){t=t.toLowerCase();var n=new CustomEvent(t,{detail:r,cancelable:!0});return f.defineProperty(n,"promise",{value:r.promise}),f.defineProperty(n,"reason",{value:r.reason}),e(C[t],n)}}return"function"==typeof Event?(t=new Event("CustomEvent"),p.global.dispatchEvent(t),function(t,r){t=t.toLowerCase();var n=new Event(t,{cancelable:!0});return n.detail=r,f.defineProperty(n,"promise",{value:r.promise}),f.defineProperty(n,"reason",{value:r.reason}),e(C[t],n)}):((t=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),p.global.dispatchEvent(t),function(t,r){t=t.toLowerCase();var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!0,r),e(C[t],n)})}catch(e){}return function(){return!1}}(),x=p.isNode?function(){return process.emit.apply(process,arguments)}:p.global?function(e){var t="on"+e.toLowerCase(),r=p.global[t];return!!r&&(r.apply(p.global,[].slice.call(arguments,1)),!0)}:function(){return!1};function T(e,t){return{promise:t}}var I={promiseCreated:T,promiseFulfilled:T,promiseRejected:T,promiseResolved:T,promiseCancelled:T,promiseChained:function(e,t,r){return{promise:t,child:r}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,r){return{reason:t,promise:r}},rejectionHandled:T},A=function(e){var t=!1;try{t=x.apply(null,arguments)}catch(e){l.throwLater(e),t=!0}var r=!1;try{r=O(e,I[e].apply(null,arguments))}catch(e){l.throwLater(e),r=!0}return r||t};function j(){return!1}function P(e,t,r){var n=this;try{e(t,r,(function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+p.toString(e));n._attachCancellationCallback(e)}))}catch(e){return e}}function M(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?p.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function R(){return this._onCancelField}function F(e){this._onCancelField=e}function D(){this._cancellationParent=void 0,this._onCancelField=void 0}function N(e,t){if(0!=(1&t)){this._cancellationParent=e;var r=e._branchesRemainingToCancel;void 0===r&&(r=0),e._branchesRemainingToCancel=r+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}t.config=function(e){if("longStackTraces"in(e=Object(e))&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&E()),"warnings"in e){var r=e.warnings;te.warnings=!!r,S=te.warnings,p.isObject(r)&&"wForgottenReturn"in r&&(S=!!r.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!te.cancellation){if(l.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=D,t.prototype._propagateFrom=N,t.prototype._onCancel=R,t.prototype._setOnCancel=F,t.prototype._attachCancellationCallback=M,t.prototype._execute=P,U=N,te.cancellation=!0}if("monitoring"in e&&(e.monitoring&&!te.monitoring?(te.monitoring=!0,t.prototype._fireEvent=A):!e.monitoring&&te.monitoring&&(te.monitoring=!1,t.prototype._fireEvent=j)),"asyncHooks"in e&&p.nodeSupportsAsyncResource){var i=te.asyncHooks,a=!!e.asyncHooks;i!==a&&(te.asyncHooks=a,a?n():o())}return t},t.prototype._fireEvent=j,t.prototype._execute=function(e,t,r){try{e(t,r)}catch(e){return e}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(e){},t.prototype._attachCancellationCallback=function(e){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._dereferenceTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(e,t){};var U=function(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)};function L(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function q(){this._trace=new Z(this._peekContext())}function B(e,t){if(h(e)){var r=this._trace;if(void 0!==r&&t&&(r=r._parent),void 0!==r)r.attachExtraTrace(e);else if(!e.__stackCleaned__){var n=W(e);p.notEnumerableProp(e,"stack",n.message+"\n"+n.stack.join("\n")),p.notEnumerableProp(e,"__stackCleaned__",!0)}}}function H(){this._trace=void 0}function V(e,r,n){if(te.warnings){var o,i=new u(e);if(r)n._attachExtraTrace(i);else if(te.longStackTraces&&(o=t._peekContext()))o.attachExtraTrace(i);else{var a=W(i);i.stack=a.message+"\n"+a.stack.join("\n")}A("warning",i)||J(i,"",!0)}}function G(e){for(var t=[],r=0;r<e.length;++r){var n=e[r],o="    (No stack trace)"===n||g.test(n),i=o&&$(n);o&&!i&&(v&&" "!==n.charAt(0)&&(n="    "+n),t.push(n))}return t}function W(e){var t=e.stack,r=e.toString();return t="string"==typeof t&&t.length>0?function(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),r=0;r<t.length;++r){var n=t[r];if("    (No stack trace)"===n||g.test(n))break}return r>0&&"SyntaxError"!=e.name&&(t=t.slice(r)),t}(e):["    (No stack trace)"],{message:r,stack:"SyntaxError"==e.name?t:G(t)}}function J(e,t,r){if("undefined"!=typeof console){var n;if(p.isObject(e)){var o=e.stack;n=t+m(o,e)}else n=t+String(e);"function"==typeof s?s(n,r):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(n)}}function Q(e,t,r,n){var o=!1;try{"function"==typeof t&&(o=!0,"rejectionHandled"===e?t(n):t(r,n))}catch(e){l.throwLater(e)}"unhandledRejection"===e?A(e,r,n)||o||J(r,"Unhandled rejection "):A(e,n)}function K(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{if(t=e&&"function"==typeof e.toString?e.toString():p.toString(e),/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+function(e){var t=41;return e.length<t?e:e.substr(0,t-3)+"..."}(t)+">, no stack trace)"}function Y(){return"function"==typeof ee}var $=function(){return!1},z=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function X(e){var t=e.match(z);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function Z(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);ee(this,Z),t>32&&this.uncycle()}p.inherits(Z,Error),r.CapturedTrace=Z,Z.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],r={},n=0,o=this;void 0!==o;++n)t.push(o),o=o._parent;for(n=(e=this._length=n)-1;n>=0;--n){var i=t[n].stack;void 0===r[i]&&(r[i]=n)}for(n=0;n<e;++n){var a=r[t[n].stack];if(void 0!==a&&a!==n){a>0&&(t[a-1]._parent=void 0,t[a-1]._length=1),t[n]._parent=void 0,t[n]._length=1;var s=n>0?t[n-1]:this;a<e-1?(s._parent=t[a+1],s._parent.uncycle(),s._length=s._parent._length+1):(s._parent=void 0,s._length=1);for(var c=s._length+1,l=n-2;l>=0;--l)t[l]._length=c,c++;return}}}},Z.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=W(e),r=t.message,n=[t.stack],o=this;void 0!==o;)n.push(G(o.stack.split("\n"))),o=o._parent;!function(e){for(var t=e[0],r=1;r<e.length;++r){for(var n=e[r],o=t.length-1,i=t[o],a=-1,s=n.length-1;s>=0;--s)if(n[s]===i){a=s;break}for(s=a;s>=0;--s){var c=n[s];if(t[o]!==c)break;t.pop(),o--}t=n}}(n),function(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}(n),p.notEnumerableProp(e,"stack",function(e,t){for(var r=0;r<t.length-1;++r)t[r].push("From previous event:"),t[r]=t[r].join("\n");return r<t.length&&(t[r]=t[r].join("\n")),e+"\n"+t.join("\n")}(r,n)),p.notEnumerableProp(e,"__stackCleaned__",!0)}};var ee=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():K(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,g=e,m=t;var r=Error.captureStackTrace;return $=function(e){return d.test(e)},function(e,t){Error.stackTraceLimit+=6,r(e,t),Error.stackTraceLimit-=6}}var n,o=new Error;if("string"==typeof o.stack&&o.stack.split("\n")[0].indexOf("stackDetection@")>=0)return g=/@/,m=t,v=!0,function(e){e.stack=(new Error).stack};try{throw new Error}catch(e){n="stack"in e}return!("stack"in o)&&n&&"number"==typeof Error.stackTraceLimit?(g=e,m=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6}):(m=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?K(t):t.toString()},null)}();"undefined"!=typeof console&&void 0!==console.warn&&(s=function(e){console.warn(e)},p.isNode&&process.stderr.isTTY?s=function(e,t){var r=t?"[33m":"[31m";console.warn(r+e+"[0m\n")}:p.isNode||"string"!=typeof(new Error).stack||(s=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var te={warnings:w,longStackTraces:!1,cancellation:!1,monitoring:!1,asyncHooks:!1};return k&&t.longStackTraces(),{asyncHooks:function(){return te.asyncHooks},longStackTraces:function(){return te.longStackTraces},warnings:function(){return te.warnings},cancellation:function(){return te.cancellation},monitoring:function(){return te.monitoring},propagateFromFunction:function(){return U},boundValueFunction:function(){return L},checkForgottenReturns:function(e,t,r,n,o){if(void 0===e&&null!==t&&S){if(void 0!==o&&o._returnedNonUndefined())return;if(0==(65535&n._bitField))return;r&&(r+=" ");var i="",a="";if(t._trace){for(var s=t._trace.stack.split("\n"),c=G(s),l=c.length-1;l>=0;--l){var u=c[l];if(!y.test(u)){var p=u.match(_);p&&(i="at "+p[1]+":"+p[2]+":"+p[3]+" ");break}}if(c.length>0){var f=c[0];for(l=0;l<s.length;++l)if(s[l]===f){l>0&&(a="\n"+s[l-1]);break}}}var h="a promise was created in a "+r+"handler "+i+"but was not returned from it, see http://goo.gl/rRqMUw"+a;n._warn(h,!0,t)}},setBounds:function(e,t){if(Y()){for(var r,n,o=(e.stack||"").split("\n"),i=(t.stack||"").split("\n"),a=-1,s=-1,c=0;c<o.length;++c)if(l=X(o[c])){r=l.fileName,a=l.line;break}for(c=0;c<i.length;++c){var l;if(l=X(i[c])){n=l.fileName,s=l.line;break}}a<0||s<0||!r||!n||r!==n||a>=s||($=function(e){if(d.test(e))return!0;var t=X(e);return!!(t&&t.fileName===r&&a<=t.line&&t.line<=s)})}},warn:V,deprecated:function(e,t){var r=e+" is deprecated and will be removed in a future version.";return t&&(r+=" Use "+t+" instead."),V(r)},CapturedTrace:Z,fireDomEvent:O,fireGlobalEvent:x}}},{"./errors":12,"./es5":13,"./util":36}],10:[function(e,t,r){"use strict";t.exports=function(e){function t(){return this.value}function r(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(r){return r instanceof e&&r.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:r},void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return this._then(r,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,r,void 0,{reason:e},void 0);var t=arguments[1],n=function(){throw t};return this.caught(e,n)},e.prototype.catchReturn=function(r){if(arguments.length<=1)return r instanceof e&&r.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:r},void 0);var n=arguments[1];n instanceof e&&n.suppressUnhandledRejections();var o=function(){return n};return this.caught(r,o)}}},{}],11:[function(e,t,r){"use strict";t.exports=function(e,t){var r=e.reduce,n=e.all;function o(){return n(this)}e.prototype.each=function(e){return r(this,e,t,0)._then(o,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return r(this,e,t,t)},e.each=function(e,n){return r(e,n,t,0)._then(o,void 0,void 0,e,void 0)},e.mapSeries=function(e,n){return r(e,n,t,t)}}},{}],12:[function(e,t,r){"use strict";var n,o,i=e("./es5"),a=i.freeze,s=e("./util"),c=s.inherits,l=s.notEnumerableProp;function u(e,t){function r(n){if(!(this instanceof r))return new r(n);l(this,"message","string"==typeof n?n:t),l(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return c(r,Error),r}var p=u("Warning","warning"),f=u("CancellationError","cancellation error"),h=u("TimeoutError","timeout error"),d=u("AggregateError","aggregate error");try{n=TypeError,o=RangeError}catch(e){n=u("TypeError","type error"),o=u("RangeError","range error")}for(var y="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),_=0;_<y.length;++_)"function"==typeof Array.prototype[y[_]]&&(d.prototype[y[_]]=Array.prototype[y[_]]);i.defineProperty(d.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),d.prototype.isOperational=!0;var g=0;function m(e){if(!(this instanceof m))return new m(e);l(this,"name","OperationalError"),l(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(l(this,"message",e.message),l(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}d.prototype.toString=function(){var e=Array(4*g+1).join(" "),t="\n"+e+"AggregateError of:\n";g++,e=Array(4*g+1).join(" ");for(var r=0;r<this.length;++r){for(var n=this[r]===this?"[Circular AggregateError]":this[r]+"",o=n.split("\n"),i=0;i<o.length;++i)o[i]=e+o[i];t+=(n=o.join("\n"))+"\n"}return g--,t},c(m,Error);var v=Error.__BluebirdErrorTypes__;v||(v=a({CancellationError:f,TimeoutError:h,OperationalError:m,RejectionError:m,AggregateError:d}),i.defineProperty(Error,"__BluebirdErrorTypes__",{value:v,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error,TypeError:n,RangeError:o,CancellationError:v.CancellationError,OperationalError:v.OperationalError,TimeoutError:v.TimeoutError,AggregateError:v.AggregateError,Warning:p}},{"./es5":13,"./util":36}],13:[function(e,t,r){var n=function(){"use strict";return void 0===this}();if(n)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return!(r&&!r.writable&&!r.set)}};else{var o={}.hasOwnProperty,i={}.toString,a={}.constructor.prototype,s=function(e){var t=[];for(var r in e)o.call(e,r)&&t.push(r);return t};t.exports={isArray:function(e){try{return"[object Array]"===i.call(e)}catch(e){return!1}},keys:s,names:s,defineProperty:function(e,t,r){return e[t]=r.value,e},getDescriptor:function(e,t){return{value:e[t]}},freeze:function(e){return e},getPrototypeOf:function(e){try{return Object(e).constructor.prototype}catch(e){return a}},isES5:n,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t,r){"use strict";t.exports=function(e,t){var r=e.map;e.prototype.filter=function(e,n){return r(this,e,n,t)},e.filter=function(e,n,o){return r(e,n,o,t)}}},{}],15:[function(e,t,r){"use strict";t.exports=function(t,r,n){var o=e("./util"),i=t.CancellationError,a=o.errorObj,s=e("./catch_filter")(n);function c(e,t,r){this.promise=e,this.type=t,this.handler=r,this.called=!1,this.cancelPromise=null}function l(e){this.finallyHandler=e}function u(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function p(){return h.call(this,this.promise._target()._settledValue())}function f(e){if(!u(this,e))return a.e=e,a}function h(e){var o=this.promise,s=this.handler;if(!this.called){this.called=!0;var c=this.isFinallyHandler()?s.call(o._boundValue()):s.call(o._boundValue(),e);if(c===n)return c;if(void 0!==c){o._setReturnedNonUndefined();var h=r(c,o);if(h instanceof t){if(null!=this.cancelPromise){if(h._isCancelled()){var d=new i("late cancellation observer");return o._attachExtraTrace(d),a.e=d,a}h.isPending()&&h._attachCancellationCallback(new l(this))}return h._then(p,f,void 0,this,void 0)}}}return o.isRejected()?(u(this),a.e=e,a):(u(this),e)}return c.prototype.isFinallyHandler=function(){return 0===this.type},l.prototype._resultCancelled=function(){u(this.finallyHandler)},t.prototype._passThrough=function(e,t,r,n){return"function"!=typeof e?this.then():this._then(r,n,void 0,new c(this,t,e),void 0)},t.prototype.lastly=t.prototype.finally=function(e){return this._passThrough(e,0,h,h)},t.prototype.tap=function(e){return this._passThrough(e,1,h)},t.prototype.tapCatch=function(e){var r=arguments.length;if(1===r)return this._passThrough(e,1,void 0,h);var n,i=new Array(r-1),a=0;for(n=0;n<r-1;++n){var c=arguments[n];if(!o.isObject(c))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+o.classString(c)));i[a++]=c}i.length=a;var l=arguments[n];return this._passThrough(s(i,l,this),1,void 0,h)},c}},{"./catch_filter":7,"./util":36}],16:[function(e,t,r){"use strict";t.exports=function(t,r,n,o,i,a){var s=e("./errors").TypeError,c=e("./util"),l=c.errorObj,u=c.tryCatch,p=[];function f(e,r,o,i){if(a.cancellation()){var s=new t(n),c=this._finallyPromise=new t(n);this._promise=s.lastly((function(){return c})),s._captureStackTrace(),s._setOnCancel(this)}else(this._promise=new t(n))._captureStackTrace();this._stack=i,this._generatorFunction=e,this._receiver=r,this._generator=void 0,this._yieldHandlers="function"==typeof o?[o].concat(p):p,this._yieldedPromise=null,this._cancellationPhase=!1}c.inherits(f,i),f.prototype._isResolved=function(){return null===this._promise},f.prototype._cleanup=function(){this._promise=this._generator=null,a.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},f.prototype._promiseCancelled=function(){if(!this._isResolved()){var e;if(void 0!==this._generator.return)this._promise._pushContext(),e=u(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var r=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=r,this._promise._attachExtraTrace(r),this._promise._pushContext(),e=u(this._generator.throw).call(this._generator,r),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},f.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=u(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},f.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=u(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},f.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},f.prototype.promise=function(){return this._promise},f.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},f.prototype._continue=function(e){var r=this._promise;if(e===l)return this._cleanup(),this._cancellationPhase?r.cancel():r._rejectCallback(e.e,!1);var n=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?r.cancel():r._resolveCallback(n);var i=o(n,this._promise);if(i instanceof t||(i=function(e,r,n){for(var i=0;i<r.length;++i){n._pushContext();var a=u(r[i])(e);if(n._popContext(),a===l){n._pushContext();var s=t.reject(l.e);return n._popContext(),s}var c=o(a,n);if(c instanceof t)return c}return null}(i,this._yieldHandlers,this._promise),null!==i)){var a=(i=i._target())._bitField;0==(50397184&a)?(this._yieldedPromise=i,i._proxy(this,null)):0!=(33554432&a)?t._async.invoke(this._promiseFulfilled,this,i._value()):0!=(16777216&a)?t._async.invoke(this._promiseRejected,this,i._reason()):this._promiseCancelled()}else this._promiseRejected(new s("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(n))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},t.coroutine=function(e,t){if("function"!=typeof e)throw new s("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=Object(t).yieldHandler,n=f,o=(new Error).stack;return function(){var t=e.apply(this,arguments),i=new n(void 0,void 0,r,o),a=i.promise();return i._generator=t,i._promiseFulfilled(void 0),a}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new s("expecting a function but got "+c.classString(e));p.push(e)},t.spawn=function(e){if(a.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return r("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=new f(e,this),o=n.promise();return n._run(t.spawn),o}}},{"./errors":12,"./util":36}],17:[function(e,t,r){"use strict";t.exports=function(t,r,n,o,i){var a=e("./util");a.canEvaluate,a.tryCatch,a.errorObj,t.join=function(){var e,t=arguments.length-1;t>0&&"function"==typeof arguments[t]&&(e=arguments[t]);var n=[].slice.call(arguments);e&&n.pop();var o=new r(n).promise();return void 0!==e?o.spread(e):o}}},{"./util":36}],18:[function(e,t,r){"use strict";t.exports=function(t,r,n,o,i,a){var s=e("./util"),c=s.tryCatch,l=s.errorObj,u=t._async;function p(e,r,n,o){this.constructor$(e),this._promise._captureStackTrace();var a=t._getContext();if(this._callback=s.contextBind(a,r),this._preservedValues=o===i?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],u.invoke(this._asyncInit,this,void 0),s.isArray(e))for(var c=0;c<e.length;++c){var l=e[c];l instanceof t&&l.suppressUnhandledRejections()}}function f(e,r,o,i){if("function"!=typeof r)return n("expecting a function but got "+s.classString(r));var a=0;if(void 0!==o){if("object"!=typeof o||null===o)return t.reject(new TypeError("options argument must be an object but it is "+s.classString(o)));if("number"!=typeof o.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+s.classString(o.concurrency)));a=o.concurrency}return new p(e,r,a="number"==typeof a&&isFinite(a)&&a>=1?a:0,i).promise()}s.inherits(p,r),p.prototype._asyncInit=function(){this._init$(void 0,-2)},p.prototype._init=function(){},p.prototype._promiseFulfilled=function(e,r){var n=this._values,i=this.length(),s=this._preservedValues,u=this._limit;if(r<0){if(n[r=-1*r-1]=e,u>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(u>=1&&this._inFlight>=u)return n[r]=e,this._queue.push(r),!1;null!==s&&(s[r]=e);var p=this._promise,f=this._callback,h=p._boundValue();p._pushContext();var d=c(f).call(h,e,r,i),y=p._popContext();if(a.checkForgottenReturns(d,y,null!==s?"Promise.filter":"Promise.map",p),d===l)return this._reject(d.e),!0;var _=o(d,this._promise);if(_ instanceof t){var g=(_=_._target())._bitField;if(0==(50397184&g))return u>=1&&this._inFlight++,n[r]=_,_._proxy(this,-1*(r+1)),!1;if(0==(33554432&g))return 0!=(16777216&g)?(this._reject(_._reason()),!0):(this._cancel(),!0);d=_._value()}n[r]=d}return++this._totalResolved>=i&&(null!==s?this._filter(n,s):this._resolve(n),!0)},p.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,r=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var n=e.pop();this._promiseFulfilled(r[n],n)}},p.prototype._filter=function(e,t){for(var r=t.length,n=new Array(r),o=0,i=0;i<r;++i)e[i]&&(n[o++]=t[i]);n.length=o,this._resolve(n)},p.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return f(this,e,t,null)},t.map=function(e,t,r,n){return f(e,t,r,n)}}},{"./util":36}],19:[function(e,t,r){"use strict";t.exports=function(t,r,n,o,i){var a=e("./util"),s=a.tryCatch;t.method=function(e){if("function"!=typeof e)throw new t.TypeError("expecting a function but got "+a.classString(e));return function(){var n=new t(r);n._captureStackTrace(),n._pushContext();var o=s(e).apply(this,arguments),a=n._popContext();return i.checkForgottenReturns(o,a,"Promise.method",n),n._resolveFromSyncValue(o),n}},t.attempt=t.try=function(e){if("function"!=typeof e)return o("expecting a function but got "+a.classString(e));var n,c=new t(r);if(c._captureStackTrace(),c._pushContext(),arguments.length>1){i.deprecated("calling Promise.try with more than 1 argument");var l=arguments[1],u=arguments[2];n=a.isArray(l)?s(e).apply(u,l):s(e).call(u,l)}else n=s(e)();var p=c._popContext();return i.checkForgottenReturns(n,p,"Promise.try",c),c._resolveFromSyncValue(n),c},t.prototype._resolveFromSyncValue=function(e){e===a.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,r){"use strict";var n=e("./util"),o=n.maybeWrapAsError,i=e("./errors").OperationalError,a=e("./es5"),s=/^(?:name|message|stack|cause)$/;function c(e){var t;if(function(e){return e instanceof Error&&a.getPrototypeOf(e)===Error.prototype}(e)){(t=new i(e)).name=e.name,t.message=e.message,t.stack=e.stack;for(var r=a.keys(e),o=0;o<r.length;++o){var c=r[o];s.test(c)||(t[c]=e[c])}return t}return n.markAsOriginatingFromRejection(e),e}t.exports=function(e,t){return function(r,n){if(null!==e){if(r){var i=c(o(r));e._attachExtraTrace(i),e._reject(i)}else if(t){var a=[].slice.call(arguments,1);e._fulfill(a)}else e._fulfill(n);e=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,r){"use strict";t.exports=function(t){var r=e("./util"),n=t._async,o=r.tryCatch,i=r.errorObj;function a(e,t){if(!r.isArray(e))return s.call(this,e,t);var a=o(t).apply(this._boundValue(),[null].concat(e));a===i&&n.throwLater(a.e)}function s(e,t){var r=this._boundValue(),a=void 0===e?o(t).call(r,null):o(t).call(r,null,e);a===i&&n.throwLater(a.e)}function c(e,t){if(!e){var r=new Error(e+"");r.cause=e,e=r}var a=o(t).call(this._boundValue(),e);a===i&&n.throwLater(a.e)}t.prototype.asCallback=t.prototype.nodeify=function(e,t){if("function"==typeof e){var r=s;void 0!==t&&Object(t).spread&&(r=a),this._then(r,c,void 0,this,e)}return this}}},{"./util":36}],22:[function(e,t,r){"use strict";t.exports=function(){var r=function(){return new g("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},n=function(){return new P.PromiseInspection(this._target())},o=function(e){return P.reject(new g(e))};function i(){}var a={},s=e("./util");s.setReflectHandler(n);var c=function(){var e=process.domain;return void 0===e?null:e},l=function(){return{domain:c(),async:null}},u=s.isNode&&s.nodeSupportsAsyncResource?e("async_hooks").AsyncResource:null,p=function(){return{domain:c(),async:new u("Bluebird::Promise")}},f=s.isNode?l:function(){return null};s.notEnumerableProp(P,"_getContext",f);var h=e("./es5"),d=e("./async"),y=new d;h.defineProperty(P,"_async",{value:y});var _=e("./errors"),g=P.TypeError=_.TypeError;P.RangeError=_.RangeError;var m=P.CancellationError=_.CancellationError;P.TimeoutError=_.TimeoutError,P.OperationalError=_.OperationalError,P.RejectionError=_.OperationalError,P.AggregateError=_.AggregateError;var v=function(){},b={},w={},k=e("./thenables")(P,v),S=e("./promise_array")(P,v,k,o,i),E=e("./context")(P),C=E.create,O=e("./debuggability")(P,E,(function(){f=p,s.notEnumerableProp(P,"_getContext",p)}),(function(){f=l,s.notEnumerableProp(P,"_getContext",l)})),x=(O.CapturedTrace,e("./finally")(P,k,w)),T=e("./catch_filter")(w),I=e("./nodeback"),A=s.errorObj,j=s.tryCatch;function P(e){e!==v&&function(e,t){if(null==e||e.constructor!==P)throw new g("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof t)throw new g("expecting a function but got "+s.classString(t))}(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function M(e){this.promise._resolveCallback(e)}function R(e){this.promise._rejectCallback(e,!1)}function F(e){var t=new P(v);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}return P.prototype.toString=function(){return"[object Promise]"},P.prototype.caught=P.prototype.catch=function(e){var t=arguments.length;if(t>1){var r,n=new Array(t-1),i=0;for(r=0;r<t-1;++r){var a=arguments[r];if(!s.isObject(a))return o("Catch statement predicate: expecting an object but got "+s.classString(a));n[i++]=a}if(n.length=i,"function"!=typeof(e=arguments[r]))throw new g("The last argument to .catch() must be a function, got "+s.toString(e));return this.then(void 0,T(n,e,this))}return this.then(void 0,e)},P.prototype.reflect=function(){return this._then(n,n,void 0,this,void 0)},P.prototype.then=function(e,t){if(O.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var r=".then() only accepts functions but was passed: "+s.classString(e);arguments.length>1&&(r+=", "+s.classString(t)),this._warn(r)}return this._then(e,t,void 0,void 0,void 0)},P.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},P.prototype.spread=function(e){return"function"!=typeof e?o("expecting a function but got "+s.classString(e)):this.all()._then(e,void 0,void 0,b,void 0)},P.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},P.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new S(this).promise()},P.prototype.error=function(e){return this.caught(s.originatesFromRejection,e)},P.getNewLibraryCopy=t.exports,P.is=function(e){return e instanceof P},P.fromNode=P.fromCallback=function(e){var t=new P(v);t._captureStackTrace();var r=arguments.length>1&&!!Object(arguments[1]).multiArgs,n=j(e)(I(t,r));return n===A&&t._rejectCallback(n.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},P.all=function(e){return new S(e).promise()},P.cast=function(e){var t=k(e);return t instanceof P||((t=new P(v))._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},P.resolve=P.fulfilled=P.cast,P.reject=P.rejected=function(e){var t=new P(v);return t._captureStackTrace(),t._rejectCallback(e,!0),t},P.setScheduler=function(e){if("function"!=typeof e)throw new g("expecting a function but got "+s.classString(e));return y.setScheduler(e)},P.prototype._then=function(e,t,r,n,o){var i=void 0!==o,a=i?o:new P(v),c=this._target(),l=c._bitField;i||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===n&&0!=(2097152&this._bitField)&&(n=0!=(50397184&l)?this._boundValue():c===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var u=f();if(0!=(50397184&l)){var p,h,d=c._settlePromiseCtx;0!=(33554432&l)?(h=c._rejectionHandler0,p=e):0!=(16777216&l)?(h=c._fulfillmentHandler0,p=t,c._unsetRejectionIsUnhandled()):(d=c._settlePromiseLateCancellationObserver,h=new m("late cancellation observer"),c._attachExtraTrace(h),p=t),y.invoke(d,c,{handler:s.contextBind(u,p),promise:a,receiver:n,value:h})}else c._addCallbacks(e,t,a,n,u);return a},P.prototype._length=function(){return 65535&this._bitField},P.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},P.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},P.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},P.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},P.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},P.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},P.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},P.prototype._isFinal=function(){return(4194304&this._bitField)>0},P.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},P.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},P.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},P.prototype._setAsyncGuaranteed=function(){if(!y.hasCustomScheduler()){var e=this._bitField;this._bitField=e|(536870912&e)>>2^134217728}},P.prototype._setNoAsyncGuarantee=function(){this._bitField=-134217729&(536870912|this._bitField)},P.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==a)return void 0===t&&this._isBound()?this._boundValue():t},P.prototype._promiseAt=function(e){return this[4*e-4+2]},P.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},P.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},P.prototype._boundValue=function(){},P.prototype._migrateCallback0=function(e){e._bitField;var t=e._fulfillmentHandler0,r=e._rejectionHandler0,n=e._promise0,o=e._receiverAt(0);void 0===o&&(o=a),this._addCallbacks(t,r,n,o,null)},P.prototype._migrateCallbackAt=function(e,t){var r=e._fulfillmentHandlerAt(t),n=e._rejectionHandlerAt(t),o=e._promiseAt(t),i=e._receiverAt(t);void 0===i&&(i=a),this._addCallbacks(r,n,o,i,null)},P.prototype._addCallbacks=function(e,t,r,n,o){var i=this._length();if(i>=65531&&(i=0,this._setLength(0)),0===i)this._promise0=r,this._receiver0=n,"function"==typeof e&&(this._fulfillmentHandler0=s.contextBind(o,e)),"function"==typeof t&&(this._rejectionHandler0=s.contextBind(o,t));else{var a=4*i-4;this[a+2]=r,this[a+3]=n,"function"==typeof e&&(this[a+0]=s.contextBind(o,e)),"function"==typeof t&&(this[a+1]=s.contextBind(o,t))}return this._setLength(i+1),i},P.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},P.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(r(),!1);var n=k(e,this);if(!(n instanceof P))return this._fulfill(e);t&&this._propagateFrom(n,2);var o=n._target();if(o!==this){var i=o._bitField;if(0==(50397184&i)){var a=this._length();a>0&&o._migrateCallback0(this);for(var s=1;s<a;++s)o._migrateCallbackAt(this,s);this._setFollowing(),this._setLength(0),this._setFollowee(n)}else if(0!=(33554432&i))this._fulfill(o._value());else if(0!=(16777216&i))this._reject(o._reason());else{var c=new m("late cancellation observer");o._attachExtraTrace(c),this._reject(c)}}else this._reject(r())}},P.prototype._rejectCallback=function(e,t,r){var n=s.ensureErrorObject(e),o=n===e;if(!o&&!r&&O.warnings()){var i="a promise was rejected with a non-error: "+s.classString(e);this._warn(i,!0)}this._attachExtraTrace(n,!!t&&o),this._reject(e)},P.prototype._resolveFromExecutor=function(e){if(e!==v){var t=this;this._captureStackTrace(),this._pushContext();var r=!0,n=this._execute(e,(function(e){t._resolveCallback(e)}),(function(e){t._rejectCallback(e,r)}));r=!1,this._popContext(),void 0!==n&&t._rejectCallback(n,!0)}},P.prototype._settlePromiseFromHandler=function(e,t,r,n){var o=n._bitField;if(0==(65536&o)){var i;n._pushContext(),t===b?r&&"number"==typeof r.length?i=j(e).apply(this._boundValue(),r):(i=A).e=new g("cannot .spread() a non-array: "+s.classString(r)):i=j(e).call(t,r);var a=n._popContext();0==(65536&(o=n._bitField))&&(i===w?n._reject(r):i===A?n._rejectCallback(i.e,!1):(O.checkForgottenReturns(i,a,"",n,this),n._resolveCallback(i)))}},P.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},P.prototype._followee=function(){return this._rejectionHandler0},P.prototype._setFollowee=function(e){this._rejectionHandler0=e},P.prototype._settlePromise=function(e,t,r,o){var a=e instanceof P,s=this._bitField,c=0!=(134217728&s);0!=(65536&s)?(a&&e._invokeInternalOnCancel(),r instanceof x&&r.isFinallyHandler()?(r.cancelPromise=e,j(t).call(r,o)===A&&e._reject(A.e)):t===n?e._fulfill(n.call(r)):r instanceof i?r._promiseCancelled(e):a||e instanceof S?e._cancel():r.cancel()):"function"==typeof t?a?(c&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,r,o,e)):t.call(r,o,e):r instanceof i?r._isResolved()||(0!=(33554432&s)?r._promiseFulfilled(o,e):r._promiseRejected(o,e)):a&&(c&&e._setAsyncGuaranteed(),0!=(33554432&s)?e._fulfill(o):e._reject(o))},P.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,r=e.promise,n=e.receiver,o=e.value;"function"==typeof t?r instanceof P?this._settlePromiseFromHandler(t,n,o,r):t.call(n,o,r):r instanceof P&&r._reject(o)},P.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},P.prototype._settlePromise0=function(e,t,r){var n=this._promise0,o=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(n,e,o,t)},P.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},P.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var n=r();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():y.settlePromises(this),this._dereferenceTrace())}},P.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return y.fatalError(e,s.isNode);(65535&t)>0?y.settlePromises(this):this._ensurePossibleRejectionHandled()}},P.prototype._fulfillPromises=function(e,t){for(var r=1;r<e;r++){var n=this._fulfillmentHandlerAt(r),o=this._promiseAt(r),i=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(o,n,i,t)}},P.prototype._rejectPromises=function(e,t){for(var r=1;r<e;r++){var n=this._rejectionHandlerAt(r),o=this._promiseAt(r),i=this._receiverAt(r);this._clearCallbackDataAtIndex(r),this._settlePromise(o,n,i,t)}},P.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!=(16842752&e)){var r=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,r,e),this._rejectPromises(t,r)}else{var n=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,n,e),this._fulfillPromises(t,n)}this._setLength(0)}this._clearCancellationData()},P.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},"undefined"!=typeof Symbol&&Symbol.toStringTag&&h.defineProperty(P.prototype,Symbol.toStringTag,{get:function(){return"Object"}}),P.defer=P.pending=function(){return O.deprecated("Promise.defer","new Promise"),{promise:new P(v),resolve:M,reject:R}},s.notEnumerableProp(P,"_makeSelfResolutionError",r),e("./method")(P,v,k,o,O),e("./bind")(P,v,k,O),e("./cancel")(P,S,o,O),e("./direct_resolve")(P),e("./synchronous_inspection")(P),e("./join")(P,S,k,v,y),P.Promise=P,P.version="3.7.2",e("./call_get.js")(P),e("./generators.js")(P,o,v,k,i,O),e("./map.js")(P,S,o,k,v,O),e("./nodeify.js")(P),e("./promisify.js")(P,v),e("./props.js")(P,S,k,o),e("./race.js")(P,v,k,o),e("./reduce.js")(P,S,o,k,v,O),e("./settle.js")(P,S,O),e("./some.js")(P,S,o),e("./timers.js")(P,v,O),e("./using.js")(P,o,k,C,v,O),e("./any.js")(P),e("./each.js")(P,v),e("./filter.js")(P,v),s.toFastProperties(P),s.toFastProperties(P.prototype),F({a:1}),F({b:2}),F({c:3}),F(1),F((function(){})),F(void 0),F(!1),F(new P(v)),O.setBounds(d.firstLineError,s.lastLineError),P}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36,async_hooks:void 0}],23:[function(e,t,r){"use strict";t.exports=function(t,r,n,o,i){var a=e("./util");function s(e){var n=this._promise=new t(r);e instanceof t&&(n._propagateFrom(e,3),e.suppressUnhandledRejections()),n._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return a.isArray,a.inherits(s,i),s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function e(r,i){var s=n(this._values,this._promise);if(s instanceof t){var c=(s=s._target())._bitField;if(this._values=s,0==(50397184&c))return this._promise._setAsyncGuaranteed(),s._then(e,this._reject,void 0,this,i);if(0==(33554432&c))return 0!=(16777216&c)?this._reject(s._reason()):this._cancel();s=s._value()}if(null!==(s=a.asArray(s)))0!==s.length?this._iterate(s):-5===i?this._resolveEmptyArray():this._resolve(function(e){switch(e){case-2:return[];case-3:return{};case-6:return new Map}}(i));else{var l=o("expecting an array or an iterable object but got "+a.classString(s)).reason();this._promise._rejectCallback(l,!1)}},s.prototype._iterate=function(e){var r=this.getActualLength(e.length);this._length=r,this._values=this.shouldCopyValues()?new Array(r):this._values;for(var o=this._promise,i=!1,a=null,s=0;s<r;++s){var c=n(e[s],o);a=c instanceof t?(c=c._target())._bitField:null,i?null!==a&&c.suppressUnhandledRejections():null!==a?0==(50397184&a)?(c._proxy(this,s),this._values[s]=c):i=0!=(33554432&a)?this._promiseFulfilled(c._value(),s):0!=(16777216&a)?this._promiseRejected(c._reason(),s):this._promiseCancelled(s):i=this._promiseFulfilled(c,s)}i||o._setAsyncGuaranteed()},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},s.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},s.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},s.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},s.prototype._promiseCancelled=function(){return this._cancel(),!0},s.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},s.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var r=0;r<e.length;++r)e[r]instanceof t&&e[r].cancel()}},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(e){return e},s}},{"./util":36}],24:[function(e,t,r){"use strict";t.exports=function(t,r){var n={},o=e("./util"),i=e("./nodeback"),a=o.withAppended,s=o.maybeWrapAsError,c=o.canEvaluate,l=e("./errors").TypeError,u={__isPromisified__:!0},p=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),f=function(e){return o.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e};function h(e){return!p.test(e)}function d(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function y(e,t,r){var n=o.getDataPropertyOrDefault(e,t+r,u);return!!n&&d(n)}function _(e,t,r,n){for(var i=o.inheritedDataKeys(e),a=[],s=0;s<i.length;++s){var c=i[s],u=e[c],p=n===f||f(c);"function"!=typeof u||d(u)||y(e,c,t)||!n(c,u,e,p)||a.push(c,u)}return function(e,t,r){for(var n=0;n<e.length;n+=2){var o=e[n];if(r.test(o))for(var i=o.replace(r,""),a=0;a<e.length;a+=2)if(e[a]===i)throw new l("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}(a,t,r),a}var g=c?void 0:function(e,c,l,u,p,f){var h=function(){return this}(),d=e;function y(){var o=c;c===n&&(o=this);var l=new t(r);l._captureStackTrace();var u="string"==typeof d&&this!==h?this[d]:e,p=i(l,f);try{u.apply(o,a(arguments,p))}catch(e){l._rejectCallback(s(e),!0,!0)}return l._isFateSealed()||l._setAsyncGuaranteed(),l}return"string"==typeof d&&(e=u),o.notEnumerableProp(y,"__isPromisified__",!0),y};function m(e,t,r,i,a){for(var s=new RegExp(t.replace(/([$])/,"\\$")+"$"),c=_(e,t,s,r),l=0,u=c.length;l<u;l+=2){var p=c[l],f=c[l+1],h=p+t;if(i===g)e[h]=g(p,n,p,f,t,a);else{var d=i(f,(function(){return g(p,n,p,f,t,a)}));o.notEnumerableProp(d,"__isPromisified__",!0),e[h]=d}}return o.toFastProperties(e),e}t.promisify=function(e,t){if("function"!=typeof e)throw new l("expecting a function but got "+o.classString(e));if(d(e))return e;var r=function(e,t,r){return g(e,t,void 0,e,null,r)}(e,void 0===(t=Object(t)).context?n:t.context,!!t.multiArgs);return o.copyDescriptors(e,r,h),r},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new l("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var r=!!(t=Object(t)).multiArgs,n=t.suffix;"string"!=typeof n&&(n="Async");var i=t.filter;"function"!=typeof i&&(i=f);var a=t.promisifier;if("function"!=typeof a&&(a=g),!o.isIdentifier(n))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=o.inheritedDataKeys(e),c=0;c<s.length;++c){var u=e[s[c]];"constructor"!==s[c]&&o.isClass(u)&&(m(u.prototype,n,i,a,r),m(u,n,i,a,r))}return m(e,n,i,a,r)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t,r){"use strict";t.exports=function(t,r,n,o){var i,a=e("./util"),s=a.isObject,c=e("./es5");"function"==typeof Map&&(i=Map);var l=function(){var e=0,t=0;function r(r,n){this[e]=r,this[e+t]=n,e++}return function(n){t=n.size,e=0;var o=new Array(2*n.size);return n.forEach(r,o),o}}();function u(e){var t,r=!1;if(void 0!==i&&e instanceof i)t=l(e),r=!0;else{var n=c.keys(e),o=n.length;t=new Array(2*o);for(var a=0;a<o;++a){var s=n[a];t[a]=e[s],t[a+o]=s}}this.constructor$(t),this._isMap=r,this._init$(void 0,r?-6:-3)}function p(e){var r,i=n(e);return s(i)?(r=i instanceof t?i._then(t.props,void 0,void 0,void 0,void 0):new u(i).promise(),i instanceof t&&r._propagateFrom(i,2),r):o("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}a.inherits(u,r),u.prototype._init=function(){},u.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var r;if(this._isMap)r=function(e){for(var t=new i,r=e.length/2|0,n=0;n<r;++n){var o=e[r+n],a=e[n];t.set(o,a)}return t}(this._values);else{r={};for(var n=this.length(),o=0,a=this.length();o<a;++o)r[this._values[o+n]]=this._values[o]}return this._resolve(r),!0}return!1},u.prototype.shouldCopyValues=function(){return!1},u.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return p(this)},t.props=function(e){return p(e)}}},{"./es5":13,"./util":36}],26:[function(e,t,r){"use strict";function n(e){this._capacity=e,this._length=0,this._front=0}n.prototype._willBeOverCapacity=function(e){return this._capacity<e},n.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},n.prototype.push=function(e,t,r){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(e),this._pushOne(t),void this._pushOne(r);var o=this._front+n-3;this._checkCapacity(n);var i=this._capacity-1;this[o+0&i]=e,this[o+1&i]=t,this[o+2&i]=r,this._length=n},n.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},n.prototype.length=function(){return this._length},n.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},n.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,function(e,t,r,n,o){for(var i=0;i<o;++i)r[i+n]=e[i+t],e[i+t]=void 0}(this,0,this,t,this._front+this._length&t-1)},t.exports=n},{}],27:[function(e,t,r){"use strict";t.exports=function(t,r,n,o){var i=e("./util");function a(e,s){var c,l=n(e);if(l instanceof t)return(c=l).then((function(e){return a(e,c)}));if(null===(e=i.asArray(e)))return o("expecting an array or an iterable object but got "+i.classString(e));var u=new t(r);void 0!==s&&u._propagateFrom(s,3);for(var p=u._fulfill,f=u._reject,h=0,d=e.length;h<d;++h){var y=e[h];(void 0!==y||h in e)&&t.cast(y)._then(p,f,void 0,u,null)}return u}t.race=function(e){return a(e,void 0)},t.prototype.race=function(){return a(this,void 0)}}},{"./util":36}],28:[function(e,t,r){"use strict";t.exports=function(t,r,n,o,i,a){var s=e("./util"),c=s.tryCatch;function l(e,r,n,o){this.constructor$(e);var a=t._getContext();this._fn=s.contextBind(a,r),void 0!==n&&(n=t.resolve(n))._attachCancellationCallback(this),this._initialValue=n,this._currentCancellable=null,this._eachValues=o===i?Array(this._length):0===o?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function u(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function p(e,t,r,o){return"function"!=typeof t?n("expecting a function but got "+s.classString(t)):new l(e,t,r,o).promise()}function f(e){this.accum=e,this.array._gotAccum(e);var r=o(this.value,this.array._promise);return r instanceof t?(this.array._currentCancellable=r,r._then(h,void 0,void 0,this,void 0)):h.call(this,r)}function h(e){var r,n=this.array,o=n._promise,i=c(n._fn);o._pushContext(),(r=void 0!==n._eachValues?i.call(o._boundValue(),e,this.index,this.length):i.call(o._boundValue(),this.accum,e,this.index,this.length))instanceof t&&(n._currentCancellable=r);var s=o._popContext();return a.checkForgottenReturns(r,s,void 0!==n._eachValues?"Promise.each":"Promise.reduce",o),r}s.inherits(l,r),l.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==i&&this._eachValues.push(e)},l.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},l.prototype._init=function(){},l.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},l.prototype.shouldCopyValues=function(){return!1},l.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},l.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel())},l.prototype._iterate=function(e){var r,n;this._values=e;var o=e.length;void 0!==this._initialValue?(r=this._initialValue,n=0):(r=t.resolve(e[0]),n=1),this._currentCancellable=r;for(var i=n;i<o;++i){var a=e[i];a instanceof t&&a.suppressUnhandledRejections()}if(!r.isRejected())for(;n<o;++n){var s={accum:null,value:e[n],index:n,length:o,array:this};r=r._then(f,void 0,void 0,s,void 0),0==(127&n)&&r._setNoAsyncGuarantee()}void 0!==this._eachValues&&(r=r._then(this._eachComplete,void 0,void 0,this,void 0)),r._then(u,u,void 0,r,this)},t.prototype.reduce=function(e,t){return p(this,e,t,null)},t.reduce=function(e,t,r,n){return p(e,t,r,n)}}},{"./util":36}],29:[function(e,t,n){"use strict";var o,i,a,s,c,l=e("./util"),u=l.getNativePromise();if(l.isNode&&"undefined"==typeof MutationObserver){var p=r.g.setImmediate,f=process.nextTick;o=l.isRecentNode?function(e){p.call(r.g,e)}:function(e){f.call(process,e)}}else if("function"==typeof u&&"function"==typeof u.resolve){var h=u.resolve();o=function(e){h.then(e)}}else o="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)||!("classList"in document.documentElement)?"undefined"!=typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:(i=document.createElement("div"),a={attributes:!0},s=!1,c=document.createElement("div"),new MutationObserver((function(){i.classList.toggle("foo"),s=!1})).observe(c,a),function(e){var t=new MutationObserver((function(){t.disconnect(),e()}));t.observe(i,a),s||(s=!0,c.classList.toggle("foo"))});t.exports=o},{"./util":36}],30:[function(e,t,r){"use strict";t.exports=function(t,r,n){var o=t.PromiseInspection;function i(e){this.constructor$(e)}e("./util").inherits(i,r),i.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(e,t){var r=new o;return r._bitField=33554432,r._settledValueField=e,this._promiseResolved(t,r)},i.prototype._promiseRejected=function(e,t){var r=new o;return r._bitField=16777216,r._settledValueField=e,this._promiseResolved(t,r)},t.settle=function(e){return n.deprecated(".settle()",".reflect()"),new i(e).promise()},t.allSettled=function(e){return new i(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t,r){"use strict";t.exports=function(t,r,n){var o=e("./util"),i=e("./errors").RangeError,a=e("./errors").AggregateError,s=o.isArray,c={};function l(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function u(e,t){if((0|t)!==t||t<0)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var r=new l(e),o=r.promise();return r.setHowMany(t),r.init(),o}o.inherits(l,r),l.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var e=s(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},l.prototype.init=function(){this._initialized=!0,this._init()},l.prototype.setUnwrap=function(){this._unwrap=!0},l.prototype.howMany=function(){return this._howMany},l.prototype.setHowMany=function(e){this._howMany=e},l.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},l.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},l.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(c),this._checkOutcome())},l.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new a,t=this.length();t<this._values.length;++t)this._values[t]!==c&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},l.prototype._fulfilled=function(){return this._totalResolved},l.prototype._rejected=function(){return this._values.length-this.length()},l.prototype._addRejected=function(e){this._values.push(e)},l.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},l.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},l.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new i(t)},l.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return u(e,t)},t.prototype.some=function(e){return u(this,e)},t._SomePromiseArray=l}},{"./errors":12,"./util":36}],32:[function(e,t,r){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var r=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},n=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},o=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},i=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},a=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},s=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return a.call(this._target())},e.prototype.isRejected=function(){return i.call(this._target())},e.prototype.isFulfilled=function(){return o.call(this._target())},e.prototype.isResolved=function(){return s.call(this._target())},e.prototype.value=function(){return r.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),n.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,r){"use strict";t.exports=function(t,r){var n=e("./util"),o=n.errorObj,i=n.isObject,a={}.hasOwnProperty;return function(e,s){if(i(e)){if(e instanceof t)return e;var c=function(e){try{return function(e){return e.then}(e)}catch(e){return o.e=e,o}}(e);if(c===o){s&&s._pushContext();var l=t.reject(c.e);return s&&s._popContext(),l}if("function"==typeof c)return function(e){try{return a.call(e,"_promise0")}catch(e){return!1}}(e)?(l=new t(r),e._then(l._fulfill,l._reject,void 0,l,null),l):function(e,i,a){var s=new t(r),c=s;a&&a._pushContext(),s._captureStackTrace(),a&&a._popContext();var l=!0,u=n.tryCatch(i).call(e,p,f);function p(e){s&&(s._resolveCallback(e),s=null)}function f(e){s&&(s._rejectCallback(e,l,!0),s=null)}return l=!1,s&&u===o&&(s._rejectCallback(u.e,!0,!0),s=null),c}(e,c,s)}return e}}},{"./util":36}],34:[function(e,t,r){"use strict";t.exports=function(t,r,n){var o=e("./util"),i=t.TimeoutError;function a(e){this.handle=e}a.prototype._resultCancelled=function(){clearTimeout(this.handle)};var s=function(e){return c(+this).thenReturn(e)},c=t.delay=function(e,o){var i,c;return void 0!==o?(i=t.resolve(o)._then(s,null,null,e,void 0),n.cancellation()&&o instanceof t&&i._setOnCancel(o)):(i=new t(r),c=setTimeout((function(){i._fulfill()}),+e),n.cancellation()&&i._setOnCancel(new a(c)),i._captureStackTrace()),i._setAsyncGuaranteed(),i};function l(e){return clearTimeout(this.handle),e}function u(e){throw clearTimeout(this.handle),e}t.prototype.delay=function(e){return c(e,this)},t.prototype.timeout=function(e,t){var r,s;e=+e;var c=new a(setTimeout((function(){r.isPending()&&function(e,t,r){var n;n="string"!=typeof t?t instanceof Error?t:new i("operation timed out"):new i(t),o.markAsOriginatingFromRejection(n),e._attachExtraTrace(n),e._reject(n),null!=r&&r.cancel()}(r,t,s)}),e));return n.cancellation()?(s=this.then(),(r=s._then(l,u,void 0,c,void 0))._setOnCancel(c)):r=this._then(l,u,void 0,c,void 0),r}}},{"./util":36}],35:[function(e,t,r){"use strict";t.exports=function(t,r,n,o,i,a){var s=e("./util"),c=e("./errors").TypeError,l=e("./util").inherits,u=s.errorObj,p=s.tryCatch,f={};function h(e){setTimeout((function(){throw e}),0)}function d(e,r){var o=0,a=e.length,s=new t(i);return function i(){if(o>=a)return s._fulfill();var c=function(e){var t=n(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}(e[o++]);if(c instanceof t&&c._isDisposable()){try{c=n(c._getDisposer().tryDispose(r),e.promise)}catch(e){return h(e)}if(c instanceof t)return c._then(i,h,null,null,null)}i()}(),s}function y(e,t,r){this._data=e,this._promise=t,this._context=r}function _(e,t,r){this.constructor$(e,t,r)}function g(e){return y.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function m(e){this.length=e,this.promise=null,this[e-1]=null}y.prototype.data=function(){return this._data},y.prototype.promise=function(){return this._promise},y.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():f},y.prototype.tryDispose=function(e){var t=this.resource(),r=this._context;void 0!==r&&r._pushContext();var n=t!==f?this.doDispose(t,e):null;return void 0!==r&&r._popContext(),this._promise._unsetDisposable(),this._data=null,n},y.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},l(_,y),_.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},m.prototype._resultCancelled=function(){for(var e=this.length,r=0;r<e;++r){var n=this[r];n instanceof t&&n.cancel()}},t.using=function(){var e=arguments.length;if(e<2)return r("you must pass at least 2 arguments to Promise.using");var o,i=arguments[e-1];if("function"!=typeof i)return r("expecting a function but got "+s.classString(i));var c=!0;2===e&&Array.isArray(arguments[0])?(e=(o=arguments[0]).length,c=!1):(o=arguments,e--);for(var l=new m(e),f=0;f<e;++f){var h=o[f];if(y.isDisposer(h)){var _=h;(h=h.promise())._setDisposable(_)}else{var v=n(h);v instanceof t&&(h=v._then(g,null,null,{resources:l,index:f},void 0))}l[f]=h}var b=new Array(l.length);for(f=0;f<b.length;++f)b[f]=t.resolve(l[f]).reflect();var w=t.all(b).then((function(e){for(var t=0;t<e.length;++t){var r=e[t];if(r.isRejected())return u.e=r.error(),u;if(!r.isFulfilled())return void w.cancel();e[t]=r.value()}k._pushContext(),i=p(i);var n=c?i.apply(void 0,e):i(e),o=k._popContext();return a.checkForgottenReturns(n,o,"Promise.using",k),n})),k=w.lastly((function(){var e=new t.PromiseInspection(w);return d(l,e)}));return l.promise=k,k._setOnCancel(l),k},t.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new _(e,this,o());throw new c}}},{"./errors":12,"./util":36}],36:[function(e,t,n){"use strict";var o=e("./es5"),i="undefined"==typeof navigator,a={e:{}},s,c="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r.g?r.g:void 0!==this?this:null;function l(){try{var e=s;return s=null,e.apply(this,arguments)}catch(e){return a.e=e,a}}function u(e){return s=e,l}var p=function(e,t){var r={}.hasOwnProperty;function n(){for(var n in this.constructor=e,this.constructor$=t,t.prototype)r.call(t.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=t.prototype[n])}return n.prototype=t.prototype,e.prototype=new n,e.prototype};function f(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function h(e){return"function"==typeof e||"object"==typeof e&&null!==e}function d(e){return f(e)?new Error(O(e)):e}function y(e,t){var r,n=e.length,o=new Array(n+1);for(r=0;r<n;++r)o[r]=e[r];return o[r]=t,o}function _(e,t,r){if(!o.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var n=Object.getOwnPropertyDescriptor(e,t);return null!=n?null==n.get&&null==n.set?n.value:r:void 0}function g(e,t,r){if(f(e))return e;var n={value:r,configurable:!0,enumerable:!1,writable:!0};return o.defineProperty(e,t,n),e}function m(e){throw e}var v=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var r=0;r<e.length;++r)if(e[r]===t)return!0;return!1};if(o.isES5){var r=Object.getOwnPropertyNames;return function(e){for(var n=[],i=Object.create(null);null!=e&&!t(e);){var a;try{a=r(e)}catch(e){return n}for(var s=0;s<a.length;++s){var c=a[s];if(!i[c]){i[c]=!0;var l=Object.getOwnPropertyDescriptor(e,c);null!=l&&null==l.get&&null==l.set&&n.push(c)}}e=o.getPrototypeOf(e)}return n}}var n={}.hasOwnProperty;return function(r){if(t(r))return[];var o=[];e:for(var i in r)if(n.call(r,i))o.push(i);else{for(var a=0;a<e.length;++a)if(n.call(e[a],i))continue e;o.push(i)}return o}}(),b=/this\s*\.\s*\S+\s*=/;function w(e){try{if("function"==typeof e){var t=o.names(e.prototype),r=o.isES5&&t.length>1,n=t.length>0&&!(1===t.length&&"constructor"===t[0]),i=b.test(e+"")&&o.names(e).length>0;if(r||n||i)return!0}return!1}catch(e){return!1}}function k(e){function t(){}t.prototype=e;var r=new t;function n(){return typeof r.foo}return n(),n(),e}var S=/^[a-z$_][a-z$_0-9]*$/i;function E(e){return S.test(e)}function C(e,t,r){for(var n=new Array(e),o=0;o<e;++o)n[o]=t+o+r;return n}function O(e){try{return e+""}catch(e){return"[no string representation]"}}function x(e){return e instanceof Error||null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function T(e){try{g(e,"isOperational",!0)}catch(e){}}function I(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function A(e){return x(e)&&o.propertyIsWritable(e,"stack")}var j="stack"in new Error?function(e){return A(e)?e:new Error(O(e))}:function(e){if(A(e))return e;try{throw new Error(O(e))}catch(e){return e}};function P(e){return{}.toString.call(e)}function M(e,t,r){for(var n=o.names(e),i=0;i<n.length;++i){var a=n[i];if(r(a))try{o.defineProperty(t,a,o.getDescriptor(e,a))}catch(e){}}}var R=function(e){return o.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var F="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,r=[],n=e[Symbol.iterator]();!(t=n.next()).done;)r.push(t.value);return r};R=function(e){return o.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?F(e):null}}var D="undefined"!=typeof process&&"[object process]"===P(process).toLowerCase(),N="undefined"!=typeof process&&void 0!==process.env,U;function L(e){return N?process.env[e]:void 0}function q(){if("function"==typeof Promise)try{if("[object Promise]"===P(new Promise((function(){}))))return Promise}catch(e){}}function B(e,t){if(null===e||"function"!=typeof t||t===U)return t;null!==e.domain&&(t=e.domain.bind(t));var r=e.async;if(null!==r){var n=t;t=function(){var e=new Array(2).concat([].slice.call(arguments));return e[0]=n,e[1]=this,r.runInAsyncScope.apply(r,e)}}return t}var H={setReflectHandler:function(e){U=e},isClass:w,isIdentifier:E,inheritedDataKeys:v,getDataPropertyOrDefault:_,thrower:m,isArray:o.isArray,asArray:R,notEnumerableProp:g,isPrimitive:f,isObject:h,isError:x,canEvaluate:i,errorObj:a,tryCatch:u,inherits:p,withAppended:y,maybeWrapAsError:d,toFastProperties:k,filledRange:C,toString:O,canAttachTrace:A,ensureErrorObject:j,originatesFromRejection:I,markAsOriginatingFromRejection:T,classString:P,copyDescriptors:M,isNode:D,hasEnvVariables:N,env:L,global:c,getNativePromise:q,contextBind:B},V;H.isRecentNode=H.isNode&&(process.versions&&process.versions.node?V=process.versions.node.split(".").map(Number):process.version&&(V=process.version.split(".").map(Number)),0===V[0]&&V[1]>10||V[0]>0),H.nodeSupportsAsyncResource=H.isNode&&function(){var t=!1;try{t="function"==typeof e("async_hooks").AsyncResource.prototype.runInAsyncScope}catch(e){t=!1}return t}(),H.isNode&&H.toFastProperties(process);try{throw new Error}catch(e){H.lastLineError=e}t.exports=H},{"./es5":13,async_hooks:void 0}]},{},[4])(4)},e.exports=n(),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)},924:(e,t,r)=>{"use strict";var n=r(210),o=r(559),i=o(n("String.prototype.indexOf"));e.exports=function(e,t){var r=n(e,!!t);return"function"==typeof r&&i(e,".prototype.")>-1?o(r):r}},559:(e,t,r)=>{"use strict";var n=r(612),o=r(210),i=o("%Function.prototype.apply%"),a=o("%Function.prototype.call%"),s=o("%Reflect.apply%",!0)||n.call(a,i),c=o("%Object.getOwnPropertyDescriptor%",!0),l=o("%Object.defineProperty%",!0),u=o("%Math.max%");if(l)try{l({},"a",{value:1})}catch(e){l=null}e.exports=function(e){var t=s(n,a,arguments);if(c&&l){var r=c(t,"length");r.configurable&&l(t,"length",{value:1+u(0,e.length-(arguments.length-1))})}return t};var p=function(){return s(n,i,arguments)};l?l(e.exports,"apply",{value:p}):e.exports.apply=p},648:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",r=Array.prototype.slice,n=Object.prototype.toString,o="[object Function]";e.exports=function(e){var i=this;if("function"!=typeof i||n.call(i)!==o)throw new TypeError(t+i);for(var a,s=r.call(arguments,1),c=function(){if(this instanceof a){var t=i.apply(this,s.concat(r.call(arguments)));return Object(t)===t?t:this}return i.apply(e,s.concat(r.call(arguments)))},l=Math.max(0,i.length-s.length),u=[],p=0;p<l;p++)u.push("$"+p);if(a=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(c),i.prototype){var f=function(){};f.prototype=i.prototype,a.prototype=new f,f.prototype=null}return a}},612:(e,t,r)=>{"use strict";var n=r(648);e.exports=Function.prototype.bind||n},210:(e,t,r)=>{"use strict";var n,o=SyntaxError,i=Function,a=TypeError,s=function(e){try{return i('"use strict"; return ('+e+").constructor;")()}catch(e){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(e){c=null}var l=function(){throw new a},u=c?function(){try{return l}catch(e){try{return c(arguments,"callee").get}catch(e){return l}}}():l,p=r(405)(),f=Object.getPrototypeOf||function(e){return e.__proto__},h={},d="undefined"==typeof Uint8Array?n:f(Uint8Array),y={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":p?f([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":h,"%AsyncGenerator%":h,"%AsyncGeneratorFunction%":h,"%AsyncIteratorPrototype%":h,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":i,"%GeneratorFunction%":h,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":p?f(f([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&p?f((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&p?f((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":p?f(""[Symbol.iterator]()):n,"%Symbol%":p?Symbol:n,"%SyntaxError%":o,"%ThrowTypeError%":u,"%TypedArray%":d,"%TypeError%":a,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet},_=function e(t){var r;if("%AsyncFunction%"===t)r=s("async function () {}");else if("%GeneratorFunction%"===t)r=s("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=s("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var o=e("%AsyncGenerator%");o&&(r=f(o.prototype))}return y[t]=r,r},g={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},m=r(612),v=r(642),b=m.call(Function.call,Array.prototype.concat),w=m.call(Function.apply,Array.prototype.splice),k=m.call(Function.call,String.prototype.replace),S=m.call(Function.call,String.prototype.slice),E=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,C=/\\(\\)?/g,O=function(e){var t=S(e,0,1),r=S(e,-1);if("%"===t&&"%"!==r)throw new o("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new o("invalid intrinsic syntax, expected opening `%`");var n=[];return k(e,E,(function(e,t,r,o){n[n.length]=r?k(o,C,"$1"):t||e})),n},x=function(e,t){var r,n=e;if(v(g,n)&&(n="%"+(r=g[n])[0]+"%"),v(y,n)){var i=y[n];if(i===h&&(i=_(n)),void 0===i&&!t)throw new a("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:i}}throw new o("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new a('"allowMissing" argument must be a boolean');var r=O(e),n=r.length>0?r[0]:"",i=x("%"+n+"%",t),s=i.name,l=i.value,u=!1,p=i.alias;p&&(n=p[0],w(r,b([0,1],p)));for(var f=1,h=!0;f<r.length;f+=1){var d=r[f],_=S(d,0,1),g=S(d,-1);if(('"'===_||"'"===_||"`"===_||'"'===g||"'"===g||"`"===g)&&_!==g)throw new o("property names with quotes must have matching quotes");if("constructor"!==d&&h||(u=!0),v(y,s="%"+(n+="."+d)+"%"))l=y[s];else if(null!=l){if(!(d in l)){if(!t)throw new a("base intrinsic for "+e+" exists, but the property is not available.");return}if(c&&f+1>=r.length){var m=c(l,d);l=(h=!!m)&&"get"in m&&!("originalValue"in m.get)?m.get:l[d]}else h=v(l,d),l=l[d];h&&!u&&(y[s]=l)}}return l}},405:(e,t,r)=>{"use strict";var n="undefined"!=typeof Symbol&&Symbol,o=r(419);e.exports=function(){return"function"==typeof n&&("function"==typeof Symbol&&("symbol"==typeof n("foo")&&("symbol"==typeof Symbol("bar")&&o())))}},419:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(42!==o.value||!0!==o.enumerable)return!1}return!0}},642:(e,t,r)=>{"use strict";var n=r(612);e.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},631:(e,t,r)=>{var n="function"==typeof Map&&Map.prototype,o=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,i=n&&o&&"function"==typeof o.get?o.get:null,a=n&&Map.prototype.forEach,s="function"==typeof Set&&Set.prototype,c=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,l=s&&c&&"function"==typeof c.get?c.get:null,u=s&&Set.prototype.forEach,p="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,f="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,h="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,d=Boolean.prototype.valueOf,y=Object.prototype.toString,_=Function.prototype.toString,g=String.prototype.match,m=String.prototype.slice,v=String.prototype.replace,b=String.prototype.toUpperCase,w=String.prototype.toLowerCase,k=RegExp.prototype.test,S=Array.prototype.concat,E=Array.prototype.join,C=Array.prototype.slice,O=Math.floor,x="function"==typeof BigInt?BigInt.prototype.valueOf:null,T=Object.getOwnPropertySymbols,I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,A="function"==typeof Symbol&&"object"==typeof Symbol.iterator,j="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===A||"symbol")?Symbol.toStringTag:null,P=Object.prototype.propertyIsEnumerable,M=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function R(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||k.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var n=e<0?-O(-e):O(e);if(n!==e){var o=String(n),i=m.call(t,o.length+1);return v.call(o,r,"$&_")+"."+v.call(v.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}}return v.call(t,r,"$&_")}var F=r(654).custom,D=F&&q(F)?F:null;function N(e,t,r){var n="double"===(r.quoteStyle||t)?'"':"'";return n+e+n}function U(e){return v.call(String(e),/"/g,"&quot;")}function L(e){return!("[object Array]"!==V(e)||j&&"object"==typeof e&&j in e)}function q(e){if(A)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!I)return!1;try{return I.call(e),!0}catch(e){}return!1}e.exports=function e(t,r,n,o){var s=r||{};if(H(s,"quoteStyle")&&"single"!==s.quoteStyle&&"double"!==s.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(H(s,"maxStringLength")&&("number"==typeof s.maxStringLength?s.maxStringLength<0&&s.maxStringLength!==1/0:null!==s.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var c=!H(s,"customInspect")||s.customInspect;if("boolean"!=typeof c&&"symbol"!==c)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(H(s,"indent")&&null!==s.indent&&"\t"!==s.indent&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(H(s,"numericSeparator")&&"boolean"!=typeof s.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var y=s.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return W(t,s);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var b=String(t);return y?R(t,b):b}if("bigint"==typeof t){var k=String(t)+"n";return y?R(t,k):k}var O=void 0===s.depth?5:s.depth;if(void 0===n&&(n=0),n>=O&&O>0&&"object"==typeof t)return L(t)?"[Array]":"[Object]";var T=function(e,t){var r;if("\t"===e.indent)r="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;r=E.call(Array(e.indent+1)," ")}return{base:r,prev:E.call(Array(t+1),r)}}(s,n);if(void 0===o)o=[];else if(G(o,t)>=0)return"[Circular]";function F(t,r,i){if(r&&(o=C.call(o)).push(r),i){var a={depth:s.depth};return H(s,"quoteStyle")&&(a.quoteStyle=s.quoteStyle),e(t,a,n+1,o)}return e(t,s,n+1,o)}if("function"==typeof t){var B=function(e){if(e.name)return e.name;var t=g.call(_.call(e),/^function\s*([\w$]+)/);if(t)return t[1];return null}(t),J=z(t,F);return"[Function"+(B?": "+B:" (anonymous)")+"]"+(J.length>0?" { "+E.call(J,", ")+" }":"")}if(q(t)){var X=A?v.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(t);return"object"!=typeof t||A?X:Q(X)}if(function(e){if(!e||"object"!=typeof e)return!1;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return!0;return"string"==typeof e.nodeName&&"function"==typeof e.getAttribute}(t)){for(var Z="<"+w.call(String(t.nodeName)),ee=t.attributes||[],te=0;te<ee.length;te++)Z+=" "+ee[te].name+"="+N(U(ee[te].value),"double",s);return Z+=">",t.childNodes&&t.childNodes.length&&(Z+="..."),Z+="</"+w.call(String(t.nodeName))+">"}if(L(t)){if(0===t.length)return"[]";var re=z(t,F);return T&&!function(e){for(var t=0;t<e.length;t++)if(G(e[t],"\n")>=0)return!1;return!0}(re)?"["+$(re,T)+"]":"[ "+E.call(re,", ")+" ]"}if(function(e){return!("[object Error]"!==V(e)||j&&"object"==typeof e&&j in e)}(t)){var ne=z(t,F);return"cause"in t&&!P.call(t,"cause")?"{ ["+String(t)+"] "+E.call(S.call("[cause]: "+F(t.cause),ne),", ")+" }":0===ne.length?"["+String(t)+"]":"{ ["+String(t)+"] "+E.call(ne,", ")+" }"}if("object"==typeof t&&c){if(D&&"function"==typeof t[D])return t[D]();if("symbol"!==c&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!i||!e||"object"!=typeof e)return!1;try{i.call(e);try{l.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var oe=[];return a.call(t,(function(e,r){oe.push(F(r,t,!0)+" => "+F(e,t))})),Y("Map",i.call(t),oe,T)}if(function(e){if(!l||!e||"object"!=typeof e)return!1;try{l.call(e);try{i.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var ie=[];return u.call(t,(function(e){ie.push(F(e,t))})),Y("Set",l.call(t),ie,T)}if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{p.call(e,p);try{f.call(e,f)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return K("WeakMap");if(function(e){if(!f||!e||"object"!=typeof e)return!1;try{f.call(e,f);try{p.call(e,p)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return K("WeakSet");if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{return h.call(e),!0}catch(e){}return!1}(t))return K("WeakRef");if(function(e){return!("[object Number]"!==V(e)||j&&"object"==typeof e&&j in e)}(t))return Q(F(Number(t)));if(function(e){if(!e||"object"!=typeof e||!x)return!1;try{return x.call(e),!0}catch(e){}return!1}(t))return Q(F(x.call(t)));if(function(e){return!("[object Boolean]"!==V(e)||j&&"object"==typeof e&&j in e)}(t))return Q(d.call(t));if(function(e){return!("[object String]"!==V(e)||j&&"object"==typeof e&&j in e)}(t))return Q(F(String(t)));if(!function(e){return!("[object Date]"!==V(e)||j&&"object"==typeof e&&j in e)}(t)&&!function(e){return!("[object RegExp]"!==V(e)||j&&"object"==typeof e&&j in e)}(t)){var ae=z(t,F),se=M?M(t)===Object.prototype:t instanceof Object||t.constructor===Object,ce=t instanceof Object?"":"null prototype",le=!se&&j&&Object(t)===t&&j in t?m.call(V(t),8,-1):ce?"Object":"",ue=(se||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(le||ce?"["+E.call(S.call([],le||[],ce||[]),": ")+"] ":"");return 0===ae.length?ue+"{}":T?ue+"{"+$(ae,T)+"}":ue+"{ "+E.call(ae,", ")+" }"}return String(t)};var B=Object.prototype.hasOwnProperty||function(e){return e in this};function H(e,t){return B.call(e,t)}function V(e){return y.call(e)}function G(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function W(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return W(m.call(e,0,t.maxStringLength),t)+n}return N(v.call(v.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,J),"single",t)}function J(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+b.call(t.toString(16))}function Q(e){return"Object("+e+")"}function K(e){return e+" { ? }"}function Y(e,t,r,n){return e+" ("+t+") {"+(n?$(r,n):E.call(r,", "))+"}"}function $(e,t){if(0===e.length)return"";var r="\n"+t.prev+t.base;return r+E.call(e,","+r)+"\n"+t.prev}function z(e,t){var r=L(e),n=[];if(r){n.length=e.length;for(var o=0;o<e.length;o++)n[o]=H(e,o)?t(e[o],e):""}var i,a="function"==typeof T?T(e):[];if(A){i={};for(var s=0;s<a.length;s++)i["$"+a[s]]=a[s]}for(var c in e)H(e,c)&&(r&&String(Number(c))===c&&c<e.length||A&&i["$"+c]instanceof Symbol||(k.call(/[^\w$]/,c)?n.push(t(c,e)+": "+t(e[c],e)):n.push(c+": "+t(e[c],e))));if("function"==typeof T)for(var l=0;l<a.length;l++)P.call(e,a[l])&&n.push("["+t(a[l])+"]: "+t(e[a[l]],e));return n}},798:e=>{"use strict";var t=String.prototype.replace,r=/%20/g,n="RFC1738",o="RFC3986";e.exports={default:o,formatters:{RFC1738:function(e){return t.call(e,r,"+")},RFC3986:function(e){return String(e)}},RFC1738:n,RFC3986:o}},129:(e,t,r)=>{"use strict";var n=r(261),o=r(235),i=r(798);e.exports={formats:i,parse:o,stringify:n}},235:(e,t,r)=>{"use strict";var n=r(769),o=Object.prototype.hasOwnProperty,i=Array.isArray,a={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},s=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},c=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},l=function(e,t,r,n){if(e){var i=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/g,s=r.depth>0&&/(\[[^[\]]*])/.exec(i),l=s?i.slice(0,s.index):i,u=[];if(l){if(!r.plainObjects&&o.call(Object.prototype,l)&&!r.allowPrototypes)return;u.push(l)}for(var p=0;r.depth>0&&null!==(s=a.exec(i))&&p<r.depth;){if(p+=1,!r.plainObjects&&o.call(Object.prototype,s[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(s[1])}return s&&u.push("["+i.slice(s.index)+"]"),function(e,t,r,n){for(var o=n?t:c(t,r),i=e.length-1;i>=0;--i){var a,s=e[i];if("[]"===s&&r.parseArrays)a=[].concat(o);else{a=r.plainObjects?Object.create(null):{};var l="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,u=parseInt(l,10);r.parseArrays||""!==l?!isNaN(u)&&s!==l&&String(u)===l&&u>=0&&r.parseArrays&&u<=r.arrayLimit?(a=[])[u]=o:"__proto__"!==l&&(a[l]=o):a={0:o}}o=a}return o}(u,t,r,n)}};e.exports=function(e,t){var r=function(e){if(!e)return a;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?a.charset:e.charset;return{allowDots:void 0===e.allowDots?a.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:a.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:a.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:a.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:a.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:a.comma,decoder:"function"==typeof e.decoder?e.decoder:a.decoder,delimiter:"string"==typeof e.delimiter||n.isRegExp(e.delimiter)?e.delimiter:a.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:a.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:a.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:a.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:a.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:a.strictNullHandling}}(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var u="string"==typeof e?function(e,t){var r,l={},u=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,p=t.parameterLimit===1/0?void 0:t.parameterLimit,f=u.split(t.delimiter,p),h=-1,d=t.charset;if(t.charsetSentinel)for(r=0;r<f.length;++r)0===f[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===f[r]?d="utf-8":"utf8=%26%2310003%3B"===f[r]&&(d="iso-8859-1"),h=r,r=f.length);for(r=0;r<f.length;++r)if(r!==h){var y,_,g=f[r],m=g.indexOf("]="),v=-1===m?g.indexOf("="):m+1;-1===v?(y=t.decoder(g,a.decoder,d,"key"),_=t.strictNullHandling?null:""):(y=t.decoder(g.slice(0,v),a.decoder,d,"key"),_=n.maybeMap(c(g.slice(v+1),t),(function(e){return t.decoder(e,a.decoder,d,"value")}))),_&&t.interpretNumericEntities&&"iso-8859-1"===d&&(_=s(_)),g.indexOf("[]=")>-1&&(_=i(_)?[_]:_),o.call(l,y)?l[y]=n.combine(l[y],_):l[y]=_}return l}(e,r):e,p=r.plainObjects?Object.create(null):{},f=Object.keys(u),h=0;h<f.length;++h){var d=f[h],y=l(d,u[d],r,"string"==typeof e);p=n.merge(p,y,r)}return!0===r.allowSparse?p:n.compact(p)}},261:(e,t,r)=>{"use strict";var n=r(478),o=r(769),i=r(798),a=Object.prototype.hasOwnProperty,s={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},c=Array.isArray,l=String.prototype.split,u=Array.prototype.push,p=function(e,t){u.apply(e,c(t)?t:[t])},f=Date.prototype.toISOString,h=i.default,d={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:o.encode,encodeValuesOnly:!1,format:h,formatter:i.formatters[h],indices:!1,serializeDate:function(e){return f.call(e)},skipNulls:!1,strictNullHandling:!1},y={},_=function e(t,r,i,a,s,u,f,h,_,g,m,v,b,w,k){for(var S,E=t,C=k,O=0,x=!1;void 0!==(C=C.get(y))&&!x;){var T=C.get(t);if(O+=1,void 0!==T){if(T===O)throw new RangeError("Cyclic object value");x=!0}void 0===C.get(y)&&(O=0)}if("function"==typeof f?E=f(r,E):E instanceof Date?E=g(E):"comma"===i&&c(E)&&(E=o.maybeMap(E,(function(e){return e instanceof Date?g(e):e}))),null===E){if(a)return u&&!b?u(r,d.encoder,w,"key",m):r;E=""}if("string"==typeof(S=E)||"number"==typeof S||"boolean"==typeof S||"symbol"==typeof S||"bigint"==typeof S||o.isBuffer(E)){if(u){var I=b?r:u(r,d.encoder,w,"key",m);if("comma"===i&&b){for(var A=l.call(String(E),","),j="",P=0;P<A.length;++P)j+=(0===P?"":",")+v(u(A[P],d.encoder,w,"value",m));return[v(I)+"="+j]}return[v(I)+"="+v(u(E,d.encoder,w,"value",m))]}return[v(r)+"="+v(String(E))]}var M,R=[];if(void 0===E)return R;if("comma"===i&&c(E))M=[{value:E.length>0?E.join(",")||null:void 0}];else if(c(f))M=f;else{var F=Object.keys(E);M=h?F.sort(h):F}for(var D=0;D<M.length;++D){var N=M[D],U="object"==typeof N&&void 0!==N.value?N.value:E[N];if(!s||null!==U){var L=c(E)?"function"==typeof i?i(r,N):r:r+(_?"."+N:"["+N+"]");k.set(t,O);var q=n();q.set(y,k),p(R,e(U,L,i,a,s,u,f,h,_,g,m,v,b,w,q))}}return R};e.exports=function(e,t){var r,o=e,l=function(e){if(!e)return d;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||d.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=i.default;if(void 0!==e.format){if(!a.call(i.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var n=i.formatters[r],o=d.filter;return("function"==typeof e.filter||c(e.filter))&&(o=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:d.addQueryPrefix,allowDots:void 0===e.allowDots?d.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:d.charsetSentinel,delimiter:void 0===e.delimiter?d.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:d.encode,encoder:"function"==typeof e.encoder?e.encoder:d.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:d.encodeValuesOnly,filter:o,format:r,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:d.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:d.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:d.strictNullHandling}}(t);"function"==typeof l.filter?o=(0,l.filter)("",o):c(l.filter)&&(r=l.filter);var u,f=[];if("object"!=typeof o||null===o)return"";u=t&&t.arrayFormat in s?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var h=s[u];r||(r=Object.keys(o)),l.sort&&r.sort(l.sort);for(var y=n(),g=0;g<r.length;++g){var m=r[g];l.skipNulls&&null===o[m]||p(f,_(o[m],m,h,l.strictNullHandling,l.skipNulls,l.encode?l.encoder:null,l.filter,l.sort,l.allowDots,l.serializeDate,l.format,l.formatter,l.encodeValuesOnly,l.charset,y))}var v=f.join(l.delimiter),b=!0===l.addQueryPrefix?"?":"";return l.charsetSentinel&&("iso-8859-1"===l.charset?b+="utf8=%26%2310003%3B&":b+="utf8=%E2%9C%93&"),v.length>0?b+v:""}},769:(e,t,r)=>{"use strict";var n=r(798),o=Object.prototype.hasOwnProperty,i=Array.isArray,a=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),s=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r};e.exports={arrayToObject:s,assign:function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var o=t[n],a=o.obj[o.prop],s=Object.keys(a),c=0;c<s.length;++c){var l=s[c],u=a[l];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:a,prop:l}),r.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(i(r)){for(var n=[],o=0;o<r.length;++o)void 0!==r[o]&&n.push(r[o]);t.obj[t.prop]=n}}}(t),e},decode:function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,t,r,o,i){if(0===e.length)return e;var s=e;if("symbol"==typeof e?s=Symbol.prototype.toString.call(e):"string"!=typeof e&&(s=String(e)),"iso-8859-1"===r)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var c="",l=0;l<s.length;++l){var u=s.charCodeAt(l);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||i===n.RFC1738&&(40===u||41===u)?c+=s.charAt(l):u<128?c+=a[u]:u<2048?c+=a[192|u>>6]+a[128|63&u]:u<55296||u>=57344?c+=a[224|u>>12]+a[128|u>>6&63]+a[128|63&u]:(l+=1,u=65536+((1023&u)<<10|1023&s.charCodeAt(l)),c+=a[240|u>>18]+a[128|u>>12&63]+a[128|u>>6&63]+a[128|63&u])}return c},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(i(e)){for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)},merge:function e(t,r,n){if(!r)return t;if("object"!=typeof r){if(i(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(n&&(n.plainObjects||n.allowPrototypes)||!o.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var a=t;return i(t)&&!i(r)&&(a=s(t,n)),i(t)&&i(r)?(r.forEach((function(r,i){if(o.call(t,i)){var a=t[i];a&&"object"==typeof a&&r&&"object"==typeof r?t[i]=e(a,r,n):t.push(r)}else t[i]=r})),t):Object.keys(r).reduce((function(t,i){var a=r[i];return o.call(t,i)?t[i]=e(t[i],a,n):t[i]=a,t}),a)}}},666:e=>{var t=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof _?t:_,i=Object.create(o.prototype),a=new T(n||[]);return i._invoke=function(e,t,r){var n=p;return function(o,i){if(n===h)throw new Error("Generator is already running");if(n===d){if("throw"===o)throw i;return A()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=C(a,r);if(s){if(s===y)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===p)throw n=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var c=u(e,t,r);if("normal"===c.type){if(n=r.done?d:f,c.arg===y)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=d,r.method="throw",r.arg=c.arg)}}}(e,r,a),i}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var p="suspendedStart",f="suspendedYield",h="executing",d="completed",y={};function _(){}function g(){}function m(){}var v={};c(v,i,(function(){return this}));var b=Object.getPrototypeOf,w=b&&b(b(I([])));w&&w!==r&&n.call(w,i)&&(v=w);var k=m.prototype=_.prototype=Object.create(v);function S(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function r(o,i,a,s){var c=u(e[o],e,i);if("throw"!==c.type){var l=c.arg,p=l.value;return p&&"object"==typeof p&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(p).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var o;this._invoke=function(e,n){function i(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(i,i):i()}}function C(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method))return y;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var o=u(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,y;var i=o.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function I(e){if(e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}return{next:A}}function A(){return{value:t,done:!0}}return g.prototype=m,c(k,"constructor",m),c(m,"constructor",g),g.displayName=c(m,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,s,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},S(E.prototype),c(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new E(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(k),c(k,s,"Generator"),c(k,i,(function(){return this})),c(k,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=I,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(x),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),x(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;x(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},478:(e,t,r)=>{"use strict";var n=r(210),o=r(924),i=r(631),a=n("%TypeError%"),s=n("%WeakMap%",!0),c=n("%Map%",!0),l=o("WeakMap.prototype.get",!0),u=o("WeakMap.prototype.set",!0),p=o("WeakMap.prototype.has",!0),f=o("Map.prototype.get",!0),h=o("Map.prototype.set",!0),d=o("Map.prototype.has",!0),y=function(e,t){for(var r,n=e;null!==(r=n.next);n=r)if(r.key===t)return n.next=r.next,r.next=e.next,e.next=r,r};e.exports=function(){var e,t,r,n={assert:function(e){if(!n.has(e))throw new a("Side channel does not contain "+i(e))},get:function(n){if(s&&n&&("object"==typeof n||"function"==typeof n)){if(e)return l(e,n)}else if(c){if(t)return f(t,n)}else if(r)return function(e,t){var r=y(e,t);return r&&r.value}(r,n)},has:function(n){if(s&&n&&("object"==typeof n||"function"==typeof n)){if(e)return p(e,n)}else if(c){if(t)return d(t,n)}else if(r)return function(e,t){return!!y(e,t)}(r,n);return!1},set:function(n,o){s&&n&&("object"==typeof n||"function"==typeof n)?(e||(e=new s),u(e,n,o)):c?(t||(t=new c),h(t,n,o)):(r||(r={key:{},next:null}),function(e,t,r){var n=y(e,t);n?n.value=r:e.next={key:t,next:e.next,value:r}}(r,n,o))}};return n}},654:()=>{}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={};(()=>{"use strict";function e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function t(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function n(e){return function(){var r=this,n=arguments;return new Promise((function(o,i){var a=e.apply(r,n);function s(e){t(a,o,i,s,c,"next",e)}function c(e){t(a,o,i,s,c,"throw",e)}s(void 0)}))}}var o=r(757),i=r.n(o);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}const l={APP_NAME:"Typing Detector",FACEBOOK_HOST:"https://www.facebook.com"};var u=c((function e(){a(this,e)}));e(u,"getCookies",(function(e){return new Promise((function(e,t){chrome.cookies.getAll({url:"https://www.facebook.com"},(function(t){e(t)}))}))})),e(u,"getCookieString",function(){var e=n(i().mark((function e(t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.getCookies(t);case 2:return r=e.sent,e.abrupt("return",r.map((function(e){return"".concat(e.name,"=").concat(e.value)})).join("; ")+";");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e(u,"getFacebookCredentials",n(i().mark((function e(){var t,r,n,o,a,s,c,p;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.getCookies(l.FACEBOOK_HOST);case 2:return t=e.sent,e.next=5,m.getLoginStatus();case 5:if(r=e.sent,n="",o="",a="",s="",c="",p="",!r){e.next=15;break}return e.next=10,u.getCookieString(l.FACEBOOK_HOST);case 10:return n=e.sent,o=t.find((function(e){return"c_user"===e.name})).value,e.next=14,m.getFbDtsg();case 14:a=e.sent;case 15:return e.abrupt("return",{isLoggedIn:r,id:o,adAccountID:c,accessToken:s,adsToken:p,fbDtsg:a,cookie:n.trim()});case 16:case"end":return e.stop()}}),e)}))));const p=u;function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?f(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var d=r(129),y=c((function e(){a(this,e)}));e(y,"send",(function(e,t){return new Promise(function(){var r=n(i().mark((function r(n,o){var a,s,c;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,p.getCookieString(l.FACEBOOK_HOST);case 2:return a=r.sent,s={method:t.method.toUpperCase(),headers:h({accept:"*/*",cookie:a,"content-type":"application/x-www-form-urlencoded","accept-encoding":"gzip","sec-fetch-dest":"document","sec-fetch-mode":"cors","sec-fetch-site":"none"},t.headers||[])},"GET"!==t.method.toUpperCase()&&(s.body=d.stringify(t.data)),r.next=7,fetch(e,s);case 7:return c=r.sent,r.t0=n,r.next=11,c.text();case 11:r.t1=r.sent,r.t2={data:r.t1},(0,r.t0)(r.t2);case 14:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())})),e(y,"setupBlockers",(function(){chrome.webRequest.onBeforeSendHeaders.addListener((function(e){var t=e.requestHeaders,r=t.findIndex((function(e){return"Origin"===e.name}));return r>=0&&(t[r].value="https://www.facebook.com"),(r=t.findIndex((function(e){return"referer"===e.name})))>=0&&(t[r].value="https://www.facebook.com"),{requestHeaders:e.requestHeaders}}),{urls:["https://www.facebook.com/*","https://*.facebook.com/api/graphqlbatch/*","https://*.facebook.com/api/graphql/*","https://upload.facebook.com/*"]},["blocking","requestHeaders","extraHeaders"]),chrome.webRequest.onBeforeSendHeaders.addListener((function(e){if(origin){var t=e.requestHeaders,r=t.findIndex((function(e){return"Origin"===e.name}));return r>=0&&(t[r].value="https://www.facebook.com"),(r=t.findIndex((function(e){return"referer"===e.name})))>=0&&(t[r].value="https://www.facebook.com"),{requestHeaders:e.requestHeaders}}}),{urls:["wss://*.facebook.com/*"],types:["xmlhttprequest","websocket"]},["blocking","requestHeaders","extraHeaders"]),chrome.webRequest.onBeforeSendHeaders.addListener((function(e){var t=e.requestHeaders,r=t.findIndex((function(e){return"Origin"===e.name}));return r>=0&&(t[r].value="https://m.facebook.com"),(r=t.findIndex((function(e){return"referer"===e.name})))>=0&&(t[r].value="https://m.facebook.com"),{requestHeaders:e.requestHeaders}}),{urls:["https://m.facebook.com/messages/send/*","https://m.facebook.com/*"]},["blocking","requestHeaders","extraHeaders"])}));const _=y;var g=function(){function e(){a(this,e)}var t,r,o;return c(e,null,[{key:"getCurrentFBID",value:(o=n(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.getCookies("https://www.facebook.com");case 2:return t=e.sent,e.abrupt("return",t.find((function(e){return"c_user"===e.name})).value);case 4:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)})},{key:"getLoginStatus",value:(r=n(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.getCookies("https://www.facebook.com");case 2:return t=e.sent,e.abrupt("return",t.findIndex((function(e){return"xs"===e.name}))>=0);case 4:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"graphQL",value:function(e,t){var r=this;return new Promise(function(){var o=n(i().mark((function n(o,a){return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=_,n.t1=APIConstant.GRAPH_URL,n.t2=e,n.next=5,r.getFbDtsg();case 5:n.t3=n.sent,n.t4=JSON.stringify(t),n.t5={doc_id:n.t2,fb_dtsg:n.t3,variables:n.t4},n.t6={method:"post",data:n.t5},n.t0.send.call(n.t0,n.t1,n.t6).then((function(e){try{o(e.data)}catch(e){a(e)}})).catch(a);case 10:case"end":return n.stop()}}),n)})));return function(e,t){return o.apply(this,arguments)}}())}},{key:"prepareIdentity",value:(t=n(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.identityLoaded){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Facebook.getLoginStatus();case 4:if(this.isLoggedIn=e.sent,!this.isLoggedIn){e.next=10;break}return e.next=8,p.getCookies("https://www.facebook.com");case 8:t=e.sent,this.userId=t.find((function(e){return"c_user"===e.name})).value;case 10:this.identityLoaded=!0;case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getFbDtsg",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((function(r,n){var o=["https://m.facebook.com/composer/ocelot/async_loader/?publisher=feed"];_.send(o[~~(Math.random()*o.length)],{method:"get",data:{}}).then((function(o){try{var i=o.data,a=i.substring(i.lastIndexOf('name=\\"fb_dtsg\\" value=\\"')+25,i.lastIndexOf('name=\\"fb_dtsg\\" value=\\"')+100),s=a.substring(0,a.indexOf('\\"'));t&&(e.fbDtsg=s),r(s)}catch(e){n(e)}})).catch(n)}))}},{key:"getAccessToken",value:function(){var e=this;return new Promise((function(t,r){_.send("https://business.facebook.com/business_locations",{method:"get",data:{}}).then((function(n){try{var o=n.data,i=o.substr(o.indexOf("LMBootstrapper"),500),a=i.substr(i.indexOf('["')+2,300).split('"')[0];e.accessToken=a,t(a)}catch(e){r(e)}})).catch(r)}))}},{key:"getAdAccountId",value:function(){var e=this;return new Promise((function(t,r){_.send("https://business.facebook.com/creatorstudio/home",{method:"get",data:{}}).then((function(n){try{var o=n.data,i=o.substr(o.indexOf("adAccountID"),500),a=i.substr(i.indexOf(':"')+2,300).split('"')[0];e.adAccountId=a,t(a)}catch(e){r(e)}})).catch(r)}))}},{key:"getAdsToken",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new Promise((function(r,n){_.send("https://www.facebook.com/adsmanager/manage/accounts?act=".concat(t||e.adAccountId),{method:"get",data:{}}).then((function(t){try{var o=t.data,i=o.substr(o.indexOf("window.__accessToken"),500),a=i.substr(i.indexOf('="')+2,300).split('"')[0];e.adsToken=a,r(a)}catch(e){n(e)}})).catch(n)}))}},{key:"loadFriends",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return""===r&&(r="me"),new Promise(function(){var r=n(i().mark((function r(n,a){var s,c,l,u,p,f,h;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return"",s=!0,c=[],r.next=5,e.getAccessToken();case 5:l=r.sent,u="https://graph.facebook.com/me/friends?fields=gender,birthday,name&access_token=".concat(l);case 7:if(!s){r.next=27;break}return p=void 0,r.prev=9,r.next=12,_.send(u,{method:"get"});case 12:p=r.sent,r.next=18;break;case 15:r.prev=15,r.t0=r.catch(9),a(r.t0);case 18:f=JSON.parse(p.data),void 0!==(h=f.paging)&&void 0!==h.next&&""!==h.next||(s=!1),s&&(u=h.next),console.log("friends data: ",f),f.data.forEach((function(e){c.length<t?c.push(e):s=!1})),null!==o&&o(c.length,f.summary?f.summary.total_count:null),r.next=7;break;case 27:n(c);case 28:case"end":return r.stop()}}),r,null,[[9,15]])})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"sendMessage",value:function(e,t){var r=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new Promise(function(){var c=n(i().mark((function n(c,l){var u;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return u={},a?u.tids="cid.g."+e:u["ids["+e+"]"]=e,u.body=s?"":t,s&&(u.sticker_id=t),u.waterfall_source="message",n.next=7,r.getFbDtsg();case 7:u.fb_dtsg=n.sent,s||o.forEach((function(e){u["photo_ids["+e+"]"]=e})),_.send("https://m.facebook.com/messages/send/?icm=1&refid=12&ref=dbl",{method:"post",data:u}).then(c).catch(l);case 10:case"end":return n.stop()}}),n)})));return function(e,t){return c.apply(this,arguments)}}())}},{key:"advancedSendMessage",value:function(e,t,r){var o=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return new Promise(function(){var l=n(i().mark((function n(l,u){var p,f,h;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return p=Math.floor(1e11*Math.random()),n.next=3,o.getFbDtsg();case 3:f=n.sent,h={fb_dtsg:f,client:"mercury",action_type:"ma-type:user-generated-message",author:"fbid:"+e,timestamp:Date.now(),timestamp_absolute:"Today",timestamp_time_passed:"0",is_unread:!1,is_cleared:!1,is_forward:!1,is_filtered_content:!1,is_filtered_content_bh:!1,is_filtered_content_account:!1,is_filtered_content_quasar:!1,is_filtered_content_invalid_app:!1,is_spoof_warning:!1,source:"source:chat:web","source_tags[0]":"source:chat",body:r?r.toString():"",html_body:!1,ui_push_phase:"V3",status:"0",message_id:p,offline_threading_id:p,"ephemeral_ttl_mode:":"0",manual_retry_cnt:"0",has_attachment:!!a.length||c,image_ids:[],gif_ids:[],file_ids:[],video_ids:[],audio_ids:[]},s?h.thread_fbid=t:(h["specific_to_list[0]"]="fbid:"+t,h["specific_to_list[1]"]="fbid:"+e,h.other_user_fbid=t),c&&(h.sticker_id=r),a.forEach((function(e){h[e.type+"s"].push(e.id)})),_.send("https://www.facebook.com/messaging/send/",{method:"post",data:h}).then(l).catch(u);case 9:case"end":return n.stop()}}),n)})));return function(e,t){return l.apply(this,arguments)}}())}},{key:"loadProfile",value:function(e){var t=this;return new Promise(function(){var r=n(i().mark((function r(n,o){var a;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.getAccessToken();case 2:a=r.sent,_.send("https://graph.facebook.com/"+e+"?access_token="+a,{method:"get"}).then((function(e){try{n(JSON.parse(e.data))}catch(e){o(e)}})).catch(o);case 4:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},{key:"validateToken",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessToken;return new Promise((function(t){_.send("https://graph.facebook.com/me?access_token="+e,{method:"get"}).then((function(e){var r=e.data;t(void 0===r.error)})).catch((function(e){console.log(e),t(!1)}))}))}},{key:"loadProfileCoverPicture",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"me";return new Promise(function(){var r=n(i().mark((function r(n){var o;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.getAccessToken();case 2:o=r.sent,_.send("https://graph.facebook.com/"+t+"?fields=cover&access_token="+o,{method:"get"}).then((function(e){var t=e.data;n(t.cover.source)})).catch((function(e){console.log(e),n("https://graphicsheat.com/wp-content/uploads/2013/06/facebook_cover_photo_by_shevy1987-d5deynh.jpg")}));case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"loadRawThreads",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["INBOX"],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(new Date).getTime()+2e4;return new Promise(function(){var a=n(i().mark((function n(a,s){return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=_,n.next=3,t.getFbDtsg();case 3:n.t1=n.sent,n.t2=JSON.stringify({o0:{doc_id:"3426149104143726",query_params:{before:o,limit:e,tags:r,includeDeliveryReceipts:!0,includeSeqID:!0}}}),n.t3={fb_dtsg:n.t1,queries:n.t2},n.t4={method:"post",data:n.t3},n.t0.send.call(n.t0,"https://www.facebook.com/api/graphqlbatch/",n.t4).then((function(e){try{var t=JSON.parse(e.data.split("\n")[0]);a(t.o0.data.viewer)}catch(e){s("PARSE_MESSAGE_ERROR")}}));case 8:case"end":return n.stop()}}),n)})));return function(e,t){return a.apply(this,arguments)}}())}},{key:"loadThreadInfo",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Promise(function(){var o=n(i().mark((function n(o,a){return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=_,n.next=3,t.getFbDtsg();case 3:n.t1=n.sent,n.t2=JSON.stringify({o0:{doc_id:"3106009512862081",query_params:{id:e.toString(),message_limit:r,load_messages:r>0,load_read_receipts:!0,load_delivery_receipts:!0,is_work_teamwork_not_putting_muted_in_unreads:!1}}}),n.t3={fb_dtsg:n.t1,queries:n.t2},n.t4={method:"post",data:n.t3},n.t0.send.call(n.t0,"https://www.facebook.com/api/graphqlbatch/",n.t4).then((function(e){try{var t=JSON.parse(e.data.split("\n")[0]);o(t.o0.data.message_thread)}catch(e){a(e)}})).catch(a);case 8:case"end":return n.stop()}}),n)})));return function(e,t){return o.apply(this,arguments)}}())}},{key:"loadCometHoverCard",value:function(e){var t=this;return new Promise(function(){var r=n(i().mark((function r(n,o){return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=_,r.next=3,t.getFbDtsg();case 3:r.t1=r.sent,r.t2=JSON.stringify({context:"DEFAULT",entityID:e,scale:1.5}),r.t3={fb_dtsg:r.t1,fb_api_caller_class:"RelayModern",fb_api_req_friendly_name:"CometHovercardQueryRendererQuery",variables:r.t2,doc_id:4613978088683237},r.t4={method:"post",data:r.t3},r.t0.send.call(r.t0,"https://www.facebook.com/api/graphql/",r.t4).then((function(e){try{var t=JSON.parse(e.data);n(t.data.node.comet_hovercard_renderer.user)}catch(e){o(e)}})).catch(o);case 8:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}}]),e}();e(g,"adAccountId",""),e(g,"accessToken",""),e(g,"adsToken",""),e(g,"lastTokenTime",0),e(g,"fbDtsg",""),e(g,"lastFbDtsgTime",0),e(g,"fbId",""),e(g,"isLoggedIn",""),e(g,"userId",""),e(g,"facebookMobileHost","https://www.facebook.com"),e(g,"dtsgExpireTime",144e5),e(g,"tokenExpireTime",864e5),e(g,"identityLoaded",!1);const m=g;var v=function(){function e(){a(this,e)}return c(e,null,[{key:"setData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Promise((function(r){var n={};n[e]=t,chrome.storage.local.set(n,r)}))}},{key:"getData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Promise((function(r){chrome.storage.local.get([e],(function(n){r(void 0===n[e]?t:n[e])}))}))}}]),e}();e(v,"removeData",(function(e){return new Promise((function(t){chrome.storage.local.remove([e],(function(){t()}))}))}));const b=v;const w={vi:JSON.parse('{"EXT_NAME":"Typing Detector For Messenger","EXT_DESCRIPTION":"Đoán xem ai đang gõ tin nhắn cho bạn?","CLEAR_HISTORY":"Xoá lịch sử","DEVELOPED_BY":"Phát triển bởi ","RELOAD":"Tải lại","ALL":"Tất cả","YOU":"Bạn","GROUP":"Nhóm","LANGUAGE":"English","TIME":"Thời điểm gõ","NAME":"Tên","RECEIVER":"Người nhận","TYPING_STATUS":"Trạng thái","TYPING":"Đang gõ","STOP":"Dừng","NO_TYPING_INDICATOR_DETECTED":"Oops, hiện chưa có người nào đang gõ tin nhắn cho bạn cả :(","SETTINGS":"Cài đặt","TYPING_WHEN_SOMEONE_IS_TYPING":"Hiện đang gõ khi có người gõ cho bạn","TYPING_WHEN_GROUP_PARTICIPANT_IS_TYPING":"Hiện đang gõ khi có người đang gõ trong nhóm","EXT_VERSION":"Bản","OUTDATED":"Cũ","LATEST":"Mới nhất"}'),en:JSON.parse('{"EXT_NAME":"Typing Detector For Messenger","EXT_DESCRIPTION":"Guess who is typing to you?","DEVELOPED_BY":"Developed by ","CLEAR_HISTORY":"Clear history","RELOAD":"Reload","ALL":"All","YOU":"You","GROUP":"Group","LANGUAGE":"Tiếng Việt","TIME":"Typing time","NAME":"Name","RECEIVER":"Receiver","TYPING_STATUS":"Typing status","TYPING":"Typing","STOP":"Stop","NO_TYPING_INDICATOR_DETECTED":"Oops, no typing indicator detected :(","SETTINGS":"Settings","TYPING_WHEN_SOMEONE_IS_TYPING":"Typing when someone is typing","TYPING_WHEN_GROUP_PARTICIPANT_IS_TYPING":"Typing when a group participant is typing","EXT_VERSION":"Ver","OUTDATED":"Outdated","LATEST":"Latest"}')};var k=function(){function e(){a(this,e)}var t,r,o;return c(e,null,[{key:"startup",value:(o=n(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.getData("language","en");case 2:return this.language=e.sent,e.next=5,this.bootFacebook();case 5:if(!this.isLoggedIn){e.next=9;break}return e.next=8,b.getData("account",{});case 8:this.account=e.sent;case 9:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"bootFacebook",value:(r=n(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.getLoginStatus();case 2:return this.isLoggedIn=e.sent,e.next=5,b.setData("isLoggedIn",this.isLoggedIn);case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"updateHistory",value:(t=n(i().mark((function e(t){var r=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>1&&void 0!==r[1]&&r[1],e.next=3,chrome.runtime.sendMessage({type:"updateHistory",data:{typingInfo:t}});case 3:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"translate",value:function(e){var t=this,r=e.split(" ");return r.forEach((function(e,n){r[n]=w[t.language][e.toUpperCase()]||e})),r.join(" ")}}]),e}();e(k,"version","1.1.0"),e(k,"cookies",""),e(k,"isLoggedIn",!1),e(k,"currentUID",""),e(k,"account",{}),e(k,"language","vi"),e(k,"app",void 0);const S=k;function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}var C,O=r(624),x=console;function T(e,t){return{"Content-Type":"application/x-www-form-urlencoded",Referer:"https://www.facebook.com/",Host:e.replace("https://","").split("/")[0],Origin:"https://www.facebook.com","User-Agent":t.userAgent,Connection:"keep-alive"}}function I(e,t,r,n){if("Object"===V(r))for(var o in r)r.hasOwnProperty(o)&&"Object"===V(r[o])&&(r[o]=JSON.stringify(r[o]));T(e,n)}function A(e,t,r,n){T(e,n)}function j(e,t,r,n,o){var i=T(e,o);i["Content-Type"]="multipart/form-data"}var P={},M={_:"%",A:"%2",B:"000",C:"%7d",D:"%7b%22",E:"%2c%22",F:"%22%3a",G:"%2c%22ut%22%3a1",H:"%2c%22bls%22%3a",I:"%2c%22n%22%3a%22%",J:"%22%3a%7b%22i%22%3a0%7d",K:"%2c%22pt%22%3a0%2c%22vis%22%3a",L:"%2c%22ch%22%3a%7b%22h%22%3a%22",M:"%7b%22v%22%3a2%2c%22time%22%3a1",N:".channel%22%2c%22sub%22%3a%5b",O:"%2c%22sb%22%3a1%2c%22t%22%3a%5b",P:"%2c%22ud%22%3a100%2c%22lc%22%3a0",Q:"%5d%2c%22f%22%3anull%2c%22uct%22%3a",R:".channel%22%2c%22sub%22%3a%5b1%5d",S:"%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a",T:"%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a",U:"%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a",V:"%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a",W:"%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a",X:"%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1",Y:"%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a",Z:"%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a"};function R(e,t){t=t||{id:"",image_data:{}};var r=(e=e.mercury?e.mercury:e).blob_attachment,n=r&&r.__typename?r.__typename:e.attach_type;switch(!n&&e.sticker_attachment?(n="StickerAttachment",r=e.sticker_attachment):!n&&e.extensible_attachment&&(n="ExtensibleAttachment",r=e.extensible_attachment),n){case"sticker":return{type:"sticker",ID:e.metadata.stickerID.toString(),url:e.url,packID:e.metadata.packID.toString(),spriteUrl:e.metadata.spriteURI,spriteUrl2x:e.metadata.spriteURI2x,width:e.metadata.width,height:e.metadata.height,caption:t.caption,description:t.description,frameCount:e.metadata.frameCount,frameRate:e.metadata.frameRate,framesPerRow:e.metadata.framesPerRow,framesPerCol:e.metadata.framesPerCol,stickerID:e.metadata.stickerID.toString(),spriteURI:e.metadata.spriteURI,spriteURI2x:e.metadata.spriteURI2x};case"file":return{type:"file",filename:e.name,ID:t.id.toString(),url:e.url,isMalicious:t.is_malicious,contentType:t.mime_type,name:e.name,mimeType:t.mime_type,fileSize:t.file_size};case"photo":return{type:"photo",ID:e.metadata.fbid.toString(),filename:e.fileName,thumbnailUrl:e.thumbnail_url,previewUrl:e.preview_url,previewWidth:e.preview_width,previewHeight:e.preview_height,largePreviewUrl:e.large_preview_url,largePreviewWidth:e.large_preview_width,largePreviewHeight:e.large_preview_height,url:e.metadata.url,width:e.metadata.dimensions.split(",")[0],height:e.metadata.dimensions.split(",")[1],name:e.fileName};case"animated_image":return{type:"animated_image",ID:t.id.toString(),filename:t.filename,previewUrl:e.preview_url,previewWidth:e.preview_width,previewHeight:e.preview_height,url:t.image_data.url,width:t.image_data.width,height:t.image_data.height,name:e.name,facebookUrl:e.url,thumbnailUrl:e.thumbnail_url,mimeType:t.mime_type,rawGifImage:t.image_data.raw_gif_image,rawWebpImage:t.image_data.raw_webp_image,animatedGifUrl:t.image_data.animated_gif_url,animatedGifPreviewUrl:t.image_data.animated_gif_preview_url,animatedWebpUrl:t.image_data.animated_webp_url,animatedWebpPreviewUrl:t.image_data.animated_webp_preview_url};case"share":return{type:"share",ID:e.share.share_id.toString(),url:t.href,title:e.share.title,description:e.share.description,source:e.share.source,image:e.share.media.image,width:e.share.media.image_size.width,height:e.share.media.image_size.height,playable:e.share.media.playable,duration:e.share.media.duration,subattachments:e.share.subattachments,properties:{},animatedImageSize:e.share.media.animated_image_size,facebookUrl:e.share.uri,target:e.share.target,styleList:e.share.style_list};case"video":return{type:"video",ID:e.metadata.fbid.toString(),filename:e.name,previewUrl:e.preview_url,previewWidth:e.preview_width,previewHeight:e.preview_height,url:e.url,width:e.metadata.dimensions.width,height:e.metadata.dimensions.height,duration:e.metadata.duration,videoType:"unknown",thumbnailUrl:e.thumbnail_url};case"error":return{type:"error",attachment1:e,attachment2:t};case"MessageImage":return{type:"photo",ID:r.legacy_attachment_id,filename:r.filename,thumbnailUrl:r.thumbnail.uri,previewUrl:r.preview.uri,previewWidth:r.preview.width,previewHeight:r.preview.height,largePreviewUrl:r.large_preview.uri,largePreviewWidth:r.large_preview.width,largePreviewHeight:r.large_preview.height,url:r.large_preview.uri,width:r.original_dimensions.x,height:r.original_dimensions.y,name:r.filename};case"MessageAnimatedImage":return{type:"animated_image",ID:r.legacy_attachment_id,filename:r.filename,previewUrl:r.preview_image.uri,previewWidth:r.preview_image.width,previewHeight:r.preview_image.height,url:r.animated_image.uri,width:r.animated_image.width,height:r.animated_image.height,thumbnailUrl:r.preview_image.uri,name:r.filename,facebookUrl:r.animated_image.uri,rawGifImage:r.animated_image.uri,animatedGifUrl:r.animated_image.uri,animatedGifPreviewUrl:r.preview_image.uri,animatedWebpUrl:r.animated_image.uri,animatedWebpPreviewUrl:r.preview_image.uri};case"MessageVideo":return{type:"video",filename:r.filename,ID:r.legacy_attachment_id,previewUrl:r.large_image.uri,previewWidth:r.large_image.width,previewHeight:r.large_image.height,url:r.playable_url,width:r.original_dimensions.x,height:r.original_dimensions.y,duration:r.playable_duration_in_ms,videoType:r.video_type.toLowerCase(),thumbnailUrl:r.large_image.uri};case"MessageAudio":return{type:"audio",filename:r.filename,ID:r.url_shimhash,audioType:r.audio_type,duration:r.playable_duration_in_ms,url:r.playable_url,isVoiceMail:r.is_voicemail};case"StickerAttachment":return{type:"sticker",ID:r.id,url:r.url,packID:r.pack?r.pack.id:null,spriteUrl:r.sprite_image,spriteUrl2x:r.sprite_image_2x,width:r.width,height:r.height,caption:r.label,description:r.label,frameCount:r.frame_count,frameRate:r.frame_rate,framesPerRow:r.frames_per_row,framesPerCol:r.frames_per_column,stickerID:r.id,spriteURI:r.sprite_image,spriteURI2x:r.sprite_image_2x};case"ExtensibleAttachment":return{type:"share",ID:r.legacy_attachment_id,url:r.story_attachment.url,title:r.story_attachment.title_with_entities.text,description:r.story_attachment.description&&r.story_attachment.description.text,source:r.story_attachment.source?r.story_attachment.source.text:null,image:r.story_attachment.media&&r.story_attachment.media.image&&r.story_attachment.media.image.uri,width:r.story_attachment.media&&r.story_attachment.media.image&&r.story_attachment.media.image.width,height:r.story_attachment.media&&r.story_attachment.media.image&&r.story_attachment.media.image.height,playable:r.story_attachment.media&&r.story_attachment.media.is_playable,duration:r.story_attachment.media&&r.story_attachment.media.playable_duration_in_ms,playableUrl:null==r.story_attachment.media?null:r.story_attachment.media.playable_url,subattachments:r.story_attachment.subattachments,properties:r.story_attachment.properties.reduce((function(e,t){return e[t.key]=t.value.text,e}),{}),facebookUrl:r.story_attachment.url,target:r.story_attachment.target,styleList:r.story_attachment.style_list};case"MessageFile":return{type:"file",filename:r.filename,ID:r.message_file_fbid,url:r.url,isMalicious:r.is_malicious,contentType:r.content_type,name:r.filename,mimeType:"",fileSize:-1};default:throw new Error("unrecognized attach_file of type "+n+"`"+JSON.stringify(e,null,4)+" attachment2: "+JSON.stringify(t,null,4)+"`")}}function F(e){return null!=e&&null!=e?e.replace(/(fb)?id[:.]/,""):e}function D(e){var t,r,n,o,i=e.message?e.message:e,a={type:"message",senderName:i.sender_name,senderID:F(i.sender_fbid.toString()),participantNames:i.group_thread_info?i.group_thread_info.participant_names:[i.sender_name.split(" ")[0]],participantIDs:i.group_thread_info?i.group_thread_info.participant_ids.map((function(e){return F(e.toString())})):[F(i.sender_fbid)],body:i.body||"",threadID:F((i.thread_fbid||i.other_user_fbid).toString()),threadName:i.group_thread_info?i.group_thread_info.name:i.sender_name,location:i.coordinates?i.coordinates:null,messageID:i.mid?i.mid.toString():i.message_id,attachments:(t=i.attachments,r=i.attachmentIds,n=i.attachment_map,o=i.share_map,n=o||n,t?t.map((function(e,t){return n&&r&&n[r[t]]?R(e,n[r[t]]):R(e)})):[]),timestamp:i.timestamp,timestampAbsolute:i.timestamp_absolute,timestampRelative:i.timestamp_relative,timestampDatetime:i.timestamp_datetime,tags:i.tags,reactions:i.reactions?i.reactions:[],isUnread:i.is_unread};return"pages_messaging"===e.type&&(a.pageID=e.realtime_viewer_fbid.toString()),a.isGroup=a.participantIDs.length>2,a}function N(e){switch(e){case"change_thread_theme":return"log:thread-color";case"change_thread_nickname":return"log:user-nickname";case"change_thread_icon":return"log:thread-icon";default:return e}}function U(e,t,r){var n=e.indexOf(t)+t.length;if(n<t.length)return"";var o=e.substring(n),i=o.indexOf(r);if(-1===i)throw Error("Could not find endTime `"+r+"` in the given string.");return o.substring(0,i)}function L(e){var t=e.replace(/for\s*\(\s*;\s*;\s*\)\s*;\s*/,"").split(/\}\r\n *\{/);return 1===t.length?t:"["+t.join("},{")+"]"}!function(){var e=[];for(var t in M)P[M[t]]=t,e.push(M[t]);e.reverse(),C=new RegExp(e.join("|"),"g")}();var q=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],B=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function H(e,t){return e[0]+"="+e[1]+"; Path="+e[3]+"; Domain="+t+".com"}function V(e){return Object.prototype.toString.call(e).slice(8,-1)}const G={get:I,post:A,postFormData:j,generateThreadingID:function(e){return"<"+Date.now()+":"+Math.floor(4294967295*Math.random())+"-"+e+"@mail.projektitan.com>"},generateOfflineThreadingID:function(){var e=Date.now(),t=("0000000000000000000000"+Math.floor(4294967295*Math.random()).toString(2)).slice(-22);return function(e){for(var t="";"0"!==e;){for(var r=0,n="",o=0;o<e.length;o++)(r=2*r+parseInt(e[o],10))>=10?(n+="1",r-=10):n+="0";t=r.toString()+t,e=n.slice(n.indexOf("1"))}return t}(e.toString(2)+t)},getGUID:function(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var r=Math.floor((e+16*Math.random())%16);return e=Math.floor(e/16),("x"==t?r:7&r|8).toString(16)}))},getFrom:U,makeParsable:L,arrToForm:function(e){return t=function(e){return e.name},r=function(e){return e.val},e.reduce((function(e,n){return e[t(n)]=r(n),e}),{});var t,r},getSignatureID:function(){return Math.floor(2147483648*Math.random()).toString(16)},generateTimestampRelative:function(){var e=new Date;return e.getHours()+":"+function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}(e.getMinutes())},makeDefaults:function(e,t,r){for(var n=1,o=U(e,'name="fb_dtsg" value="','"'),i="2",a=0;a<o.length;a++)i+=o.charCodeAt(a);var s=U(e,'revision":',",");function c(e){var a={__user:t,__req:(n++).toString(36),__rev:s,__a:1,fb_dtsg:r.fb_dtsg?r.fb_dtsg:o,jazoest:r.ttstamp?r.ttstamp:i};if(!e)return a;for(var c in e)e.hasOwnProperty(c)&&(a[c]||(a[c]=e[c]));return a}return{get:function(e,t,n){return I(e,0,c(n),r.globalOptions)},post:function(e,t,n){return A(e,0,c(n),r.globalOptions)},postFormData:function(e,t,n,o){return j(e,0,c(n),c(o),r.globalOptions)}}},parseAndCheckLogin:function e(t,r,n){return null==n&&(n=0),function(o){return O.try((function(){if(x.verbose("parseAndCheckLogin",o.body),o.statusCode>=500&&o.statusCode<600){if(n>=5)throw{error:"Request retry failed. Check the `res` and `statusCode` property on this error.",statusCode:o.statusCode,res:o.body};n++;var i=Math.floor(5e3*Math.random());x.warn("parseAndCheckLogin","Got status code "+o.statusCode+" - "+n+". attempt to retry in "+i+" milliseconds...");var a=o.request.uri.protocol+"//"+o.request.uri.hostname+o.request.uri.pathname;return"multipart/form-data"===o.request.headers["Content-Type"].split(";")[0]?O.delay(i).then((function(){return r.postFormData(a,t.jar,o.request.formData,{})})).then(e(t,r,n)):O.delay(i).then((function(){return r.post(a,t.jar,o.request.formData)})).then(e(t,r,n))}if(200!==o.statusCode)throw new Error("parseAndCheckLogin got status code: "+o.statusCode+". Bailing out of trying to parse response.");var s=null;try{s=JSON.parse(L(o.body))}catch(e){throw{error:"JSON.parse error. Check the `detail` property on this error.",detail:e,res:o.body}}if(s.redirect&&"GET"===o.request.method)return r.get(s.redirect,t.jar).then(e(t,r));if(s.jsmods&&s.jsmods.require&&Array.isArray(s.jsmods.require[0])&&"Cookie"===s.jsmods.require[0][0]){s.jsmods.require[0][3][0]=s.jsmods.require[0][3][0].replace("_js_","");var c=H(s.jsmods.require[0][3],"facebook"),l=H(s.jsmods.require[0][3],"messenger");t.jar.setCookie(c,"https://www.facebook.com"),t.jar.setCookie(l,"https://www.messenger.com")}if(s.jsmods&&Array.isArray(s.jsmods.require)){var u=s.jsmods.require;for(var p in u)if("DTSG"===u[p][0]&&"setToken"===u[p][1]){t.fb_dtsg=u[p][3][0],t.ttstamp="2";for(var f=0;f<t.fb_dtsg.length;f++)t.ttstamp+=t.fb_dtsg.charCodeAt(f)}}if(1357001===s.error)throw{error:"Not logged in."};return s}))}},saveCookies:function(e){return function(t){return(t.headers["set-cookie"]||[]).forEach((function(t){t.indexOf(".facebook.com")>-1&&e.setCookie(t,"https://www.facebook.com");var r=t.replace(/domain=\.facebook\.com/,"domain=.messenger.com");e.setCookie(r,"https://www.messenger.com")})),t}},getType:V,_formatAttachment:R,formatHistoryMessage:function(e){return"ma-type:log-message"===e.action_type?function(e){var t,r=e.message?e.message:e,n=r.log_message_type;return"log:generic-admin-text"===n?(t=r.log_message_data.untypedData,n=N(r.log_message_data.message_type)):t=r.log_message_data,Object.assign(D(r),{type:"event",logMessageType:n,logMessageData:t,logMessageBody:r.log_message_body})}(e):D(e)},formatID:F,formatMessage:D,formatDeltaEvent:function(e){var t,r;switch(e.class){case"AdminTextMessage":r=e.untypedData,t=N(e.type);break;case"ThreadName":t="log:thread-name",r={name:e.name};break;case"ParticipantsAddedToGroupThread":t="log:subscribe",r={addedParticipants:e.addedParticipants};break;case"ParticipantLeftGroupThread":t="log:unsubscribe",r={leftParticipantFbId:e.leftParticipantFbId}}return{type:"event",threadID:F((e.messageMetadata.threadKey.threadFbId||e.messageMetadata.threadKey.otherUserFbId).toString()),logMessageType:t,logMessageData:r,logMessageBody:e.messageMetadata.adminText,author:e.messageMetadata.actorFbId}},formatDeltaMessage:function(e){for(var t=e.delta.messageMetadata,r=void 0===e.delta.data||void 0===e.delta.data.prng?[]:JSON.parse(e.delta.data.prng),n=r.map((function(e){return e.i})),o=r.map((function(e){return e.o})),i=r.map((function(e){return e.l})),a={},s=0;s<n.length;s++)a[n[s]]=e.delta.body.substring(o[s],o[s]+i[s]);return{type:"message",senderID:F(t.actorFbId.toString()),body:e.delta.body||"",threadID:F((t.threadKey.threadFbId||t.threadKey.otherUserFbId).toString()),messageID:t.messageId,attachments:(e.delta.attachments||[]).map((function(e){return R(e)})),mentions:a,timestamp:t.timestamp,isGroup:!!t.threadKey.threadFbId}},formatProxyPresence:function(e,t){return void 0===e.lat||void 0===e.p?null:{type:"presence",timestamp:1e3*e.lat,userID:t,statuses:e.p}},formatPresence:function(e,t){return{type:"presence",timestamp:1e3*e.la,userID:t,statuses:e.a}},formatTyp:function(e){return{isTyping:!!e.st,from:e.from.toString(),threadID:F((e.to||e.thread_fbid||e.from).toString()),fromMobile:!e.hasOwnProperty("from_mobile")||e.from_mobile,userID:(e.realtime_viewer_fbid||e.from).toString(),type:"typ"}},formatDeltaReadReceipt:function(e){return{reader:(e.threadKey.otherUserFbId||e.actorFbId).toString(),time:e.actionTimestampMs,threadID:F((e.threadKey.otherUserFbId||e.threadKey.threadFbId).toString()),type:"read_receipt"}},formatCookie:H,formatThread:function(e){return{threadID:F(e.thread_fbid.toString()),participants:e.participants.map(F),participantIDs:e.participants.map(F),name:e.name,nicknames:e.custom_nickname,snippet:e.snippet,snippetAttachments:e.snippet_attachments,snippetSender:F((e.snippet_sender||"").toString()),unreadCount:e.unread_count,messageCount:e.message_count,imageSrc:e.image_src,timestamp:e.timestamp,serverTimestamp:e.server_timestamp,muteUntil:e.mute_until,isCanonicalUser:e.is_canonical_user,isCanonical:e.is_canonical,isSubscribed:e.is_subscribed,folder:e.folder,isArchived:e.is_archived,recipientsLoadable:e.recipients_loadable,hasEmailParticipant:e.has_email_participant,readOnly:e.read_only,canReply:e.can_reply,cannotReplyReason:e.cannot_reply_reason,lastMessageTimestamp:e.last_message_timestamp,lastReadTimestamp:e.last_read_timestamp,lastMessageType:e.last_message_type,emoji:e.custom_like_icon,color:e.custom_color,adminIDs:e.admin_ids,threadType:e.thread_type}},formatReadReceipt:function(e){return{reader:e.reader.toString(),time:e.time,threadID:F((e.thread_fbid||e.reader).toString()),type:"read_receipt"}},formatRead:function(e){return{threadID:F((e.chat_ids&&e.chat_ids[0]||e.thread_fbids&&e.thread_fbids[0]).toString()),time:e.timestamp,type:"read"}},generatePresence:function(t){var r,n=Date.now();return"E"+(r=JSON.stringify({v:3,time:parseInt(n/1e3,10),user:t,state:{ut:0,t2:[],lm2:null,uct2:n,tr:null,tw:Math.floor(4294967295*Math.random())+1,at:n},ch:e({},"p_"+t,0)}),encodeURIComponent(r).replace(/([_A-Z])|%../g,(function(e,t){return t?"%"+t.charCodeAt(0).toString(16):e})).toLowerCase().replace(C,(function(e){return P[e]})))},generateAccessiblityCookie:function(){var e=Date.now();return encodeURIComponent(JSON.stringify({sr:0,"sr-ts":e,jk:0,"jk-ts":e,kb:0,"kb-ts":e,hcm:0,"hcm-ts":e}))},formatDate:function(e){var t=e.getUTCDate();t=t>=10?t:"0"+t;var r=e.getUTCHours();r=r>=10?r:"0"+r;var n=e.getUTCMinutes();n=n>=10?n:"0"+n;var o=e.getUTCSeconds();return o=o>=10?o:"0"+o,B[e.getUTCDay()]+", "+t+" "+q[e.getUTCMonth()]+" "+e.getUTCFullYear()+" "+r+":"+n+":"+o+" GMT"},decodeClientPayload:function(e){return JSON.parse(String.fromCharCode.apply(null,e))},getAppState:function(e){return e.getCookies("https://www.facebook.com").concat(e.getCookies("https://facebook.com")).concat(e.getCookies("https://www.messenger.com"))},getAdminTextMessageType:N};var W={getItem:b.getData,setItem:b.setData,removeItem:b.removeData},J=function(e){var t=1,r=2,n=3,o=4,i=5,a=6,s=7,c=8,l=9,u=10,p=11,f=12,h=13,d=14,y=function(e,t){for(var r in e)if(e.hasOwnProperty(r)){if(!t.hasOwnProperty(r)){var n="Unknown property, "+r+". Valid properties are:";for(var r in t)t.hasOwnProperty(r)&&(n=n+" "+r);throw new Error(n)}if(E(e[r])!==t[r])throw new Error(v(g.INVALID_TYPE,[E(e[r]),r]))}},_=function(e,t){return function(){return e.apply(t,arguments)}},g={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error."},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."}},m={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},v=function(e,t){var r=e.text;if(t)for(var n=0;n<t.length;n++){var o="{"+n+"}",i=r.indexOf(o);if(i>0){var a=r.substring(0,i),s=r.substring(i+o.length);r=a+t[n]+s}}return r},b=[0,6,77,81,73,115,100,112,3],w=function(e,t){for(name in this.type=e,t)t.hasOwnProperty(name)&&(this[name]=t[name])};function k(e,t,r){return t[r++]=e>>8,t[r++]=e%256,r}function S(e,t,r,n){return x(e,r,n=k(t,r,n)),n+t}function C(e,t){return 256*e[t]+e[t+1]}function O(e){for(var t=0,r=0;r<e.length;r++){var n=e.charCodeAt(r);n>2047?(55296<=n&&n<=56319&&(r++,t++),t+=3):n>127?t+=2:t++}return t}function x(e,t,r){for(var n=r,o=0;o<e.length;o++){var i=e.charCodeAt(o);if(55296<=i&&i<=56319){var a=e.charCodeAt(++o);if(isNaN(a))throw new Error(v(g.MALFORMED_UNICODE,[i,a]));i=a-56320+(i-55296<<10)+65536}i<=127?t[n++]=i:i<=2047?(t[n++]=i>>6&31|192,t[n++]=63&i|128):i<=65535?(t[n++]=i>>12&15|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18&7|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}function T(e,t,r){for(var n,o="",i=t;i<t+r;){var a=e[i++];if(a<128)n=a;else{var s=e[i++]-128;if(s<0&&console.log(v(g.MALFORMED_UTF,[a.toString(16),s.toString(16),""])),a<224)n=64*(a-192)+s;else{var c=e[i++]-128;if(c<0&&console.log(v(g.MALFORMED_UTF,[a.toString(16),s.toString(16),c.toString(16)])),a<240)n=4096*(a-224)+64*s+c;else{var l=e[i++]-128;l<0&&console.log(v(g.MALFORMED_UTF,[a.toString(16),s.toString(16),c.toString(16),l.toString(16)])),a<248?n=262144*(a-240)+4096*s+64*c+l:console.log(v(g.MALFORMED_UTF,[a.toString(16),s.toString(16),c.toString(16),l.toString(16)]))}}}n>65535&&(n-=65536,o+=String.fromCharCode(55296+(n>>10)),n=56320+(1023&n)),o+=String.fromCharCode(n)}return o}w.prototype.encode=function(){var e=(15&this.type)<<4,r=0,o=new Array;switch(null!=this.messageIdentifier&&(r+=2),this.type){case t:if(r+=b.length+3,r+=O(this.clientId)+2,null!=this.willMessage){r+=O(this.willMessage.destinationName)+2;var i=this.willMessage.payloadBytes;i instanceof Uint8Array||(i=new Uint8Array(l)),r+=i.byteLength+2}null!=this.userName&&(r+=O(this.userName)+2),null!=this.password&&(r+=O(this.password)+2);break;case c:e|=2;for(var a=0;a<this.topics.length;a++)o[a]=O(this.topics[a]),r+=o[a]+2;r+=this.requestedQos.length;break;case u:e|=2;for(a=0;a<this.topics.length;a++)o[a]=O(this.topics[a]),r+=o[a]+2;break;case n:this.payloadMessage.duplicate&&(e|=8),e=e|=this.payloadMessage.qos<<1,this.payloadMessage.retained&&(e|=1);var s=O(this.payloadMessage.destinationName);r+=s+2;var l=this.payloadMessage.payloadBytes;r+=l.byteLength,l instanceof ArrayBuffer?l=new Uint8Array(l):l instanceof Uint8Array||(l=new Uint8Array(l.buffer))}var p=function(e){var t=new Array(1),r=0;do{var n=e%128;(e>>=7)>0&&(n|=128),t[r++]=n}while(e>0&&r<4);return t}(r),f=p.length+1,h=new ArrayBuffer(r+f),d=new Uint8Array(h);if(d[0]=e,d.set(p,1),this.type==n)f=S(this.payloadMessage.destinationName,s,d,f);else if(this.type==t){d.set(b,f),f+=b.length;var y=0;this.cleanSession&&(y=2),null!=this.willMessage&&(y|=4,y|=this.willMessage.qos<<3,this.willMessage.retained&&(y|=32)),null!=this.userName&&(y|=128),null!=this.password&&(y|=64),d[f++]=y,f=k(this.keepAliveInterval,d,f)}switch(null!=this.messageIdentifier&&(f=k(this.messageIdentifier,d,f)),this.type){case t:f=S(this.clientId,O(this.clientId),d,f),null!=this.willMessage&&(f=S(this.willMessage.destinationName,O(this.willMessage.destinationName),d,f),f=k(i.byteLength,d,f),d.set(i,f),f+=i.byteLength),null!=this.userName&&(f=S(this.userName,O(this.userName),d,f)),null!=this.password&&(f=S(this.password,O(this.password),d,f));break;case n:d.set(l,f);break;case c:for(a=0;a<this.topics.length;a++)f=S(this.topics[a],o[a],d,f),d[f++]=this.requestedQos[a];break;case u:for(a=0;a<this.topics.length;a++)f=S(this.topics[a],o[a],d,f)}return h};var I=function(e,t,r){this._client=e,this._window=t,this._keepAliveInterval=1e3*r,this.isReset=!1;var n=new w(f).encode(),o=function(e){return function(){return i.apply(e)}},i=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(n),this.timeout=this._window.setTimeout(o(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(g.PING_TIMEOUT.code,v(g.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0,this._window.clearTimeout(this.timeout),this._keepAliveInterval>0&&(this.timeout=setTimeout(o(this),this._keepAliveInterval))},this.cancel=function(){this._window.clearTimeout(this.timeout)}},A=function(e,t,r,n,o){this._window=t,r||(r=30);this.timeout=setTimeout(function(e,t,r){return function(){return e.apply(t,r)}}(n,e,o),1e3*r),this.cancel=function(){this._window.clearTimeout(this.timeout)}},j=function(t,r,n){if(!("WebSocket"in e)||null===e.WebSocket)throw new Error(v(g.UNSUPPORTED,["WebSocket"]));if(!("localStorage"in e)||null===e.localStorage)throw new Error(v(g.UNSUPPORTED,["localStorage"]));if(!("ArrayBuffer"in e)||null===e.ArrayBuffer)throw new Error(v(g.UNSUPPORTED,["ArrayBuffer"]));for(var o in this._trace("Messaging.Client",t,r,n),this.host=t,this.port=r,this.clientId=n,this._localKey=t+":"+r+":"+n+":",this._msg_queue=[],this._sentMessages={},this._receivedMessages={},this._notify_msg_sent={},this._message_identifier=1,this._sequence=0,W)0!=o.indexOf("Sent:"+this._localKey)&&0!=o.indexOf("Received:"+this._localKey)||this.restore(o)};j.prototype.host,j.prototype.port,j.prototype.clientId,j.prototype.socket,j.prototype.connected=!1,j.prototype.maxMessageIdentifier=65536,j.prototype.connectOptions,j.prototype.hostIndex,j.prototype.onConnectionLost,j.prototype.onMessageDelivered,j.prototype.onMessageArrived,j.prototype._msg_queue=null,j.prototype._connectTimeout,j.prototype.sendPinger=null,j.prototype.receivePinger=null,j.prototype._traceBuffer=null,j.prototype._MAX_TRACE_ENTRIES=100,j.prototype.connect=function(e){var t=this._traceMask(e,"password");if(this._trace("Client.connect",t,this.socket,this.connected),this.connected)throw new Error(v(g.INVALID_STATE,["already connected"]));if(this.socket)throw new Error(v(g.INVALID_STATE,["already connected"]));this.connectOptions=e,e.hosts?(this.hostIndex=0,this._doConnect(e.hosts[0],e.ports[0])):this._doConnect(this.host,this.port)},j.prototype.subscribe=function(e,t){if(this._trace("Client.subscribe",e,t),!this.connected)throw new Error(v(g.INVALID_STATE,["not connected"]));var r=new w(c);r.topics=[e],null!=t.qos?r.requestedQos=[t.qos]:r.requestedQos=[0],t.onSuccess&&(r.callback=function(){t.onSuccess({invocationContext:t.invocationContext})}),t.timeout&&(r.timeOut=new A(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:g.SUBSCRIBE_TIMEOUT.code,errorMessage:v(g.SUBSCRIBE_TIMEOUT)}])),this._requires_ack(r),this._schedule_message(r)},j.prototype.unsubscribe=function(e,t){if(this._trace("Client.unsubscribe",e,t),!this.connected)throw new Error(v(g.INVALID_STATE,["not connected"]));var r=new w(u);r.topics=[e],t.onSuccess&&(r.callback=function(){t.onSuccess({invocationContext:t.invocationContext})}),t.timeout&&(r.timeOut=new A(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:g.UNSUBSCRIBE_TIMEOUT.code,errorMessage:v(g.UNSUBSCRIBE_TIMEOUT)}])),this._requires_ack(r),this._schedule_message(r)},j.prototype.send=function(e){if(this._trace("Client.send",e),!this.connected)throw new Error(v(g.INVALID_STATE,["not connected"]));var t=new w(n);t.payloadMessage=e,e.qos>0?this._requires_ack(t):this.onMessageDelivered&&(this._notify_msg_sent[t]=this.onMessageDelivered(t.payloadMessage)),this._schedule_message(t)},j.prototype.disconnect=function(){if(this._trace("Client.disconnect"),!this.socket)throw new Error(v(g.INVALID_STATE,["not connecting or connected"]));var e=new w(d);this._notify_msg_sent[e]=_(this._disconnected,this),this._schedule_message(e)},j.prototype.getTraceLog=function(){if(null!==this._traceBuffer){for(var e in this._trace("Client.getTraceLog",new Date),this._trace("Client.getTraceLog in flight messages",this._sentMessages.length),this._sentMessages)this._trace("_sentMessages ",e,this._sentMessages[e]);for(var e in this._receivedMessages)this._trace("_receivedMessages ",e,this._receivedMessages[e]);return this._traceBuffer}},j.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]),this._trace("Client.startTrace",new Date,"0.0.0.0")},j.prototype.stopTrace=function(){delete this._traceBuffer},j.prototype._doConnect=function(e,t){this.connected=!1,this.socket=new WebSocket(e),this.socket.binaryType="arraybuffer",this.socket.onopen=_(this._on_socket_open,this),this.socket.onmessage=_(this._on_socket_message,this),this.socket.onerror=_(this._on_socket_error,this),this.socket.onclose=_(this._on_socket_close,this),this.sendPinger=new I(this,window,this.connectOptions.keepAliveInterval),this.receivePinger=new I(this,window,this.connectOptions.keepAliveInterval),this._connectTimeout=new A(this,window,this.connectOptions.timeout,this._disconnected,[g.CONNECT_TIMEOUT.code,v(g.CONNECT_TIMEOUT)])},j.prototype._schedule_message=function(e){this._msg_queue.push(e),this.connected&&this._process_queue()},j.prototype.store=function(e,t){var r={type:t.type,messageIdentifier:t.messageIdentifier,version:1};if(t.type!==n)throw Error(v(g.INVALID_STORED_DATA,[key,r]));t.pubRecReceived&&(r.pubRecReceived=!0),r.payloadMessage={};for(var o="",i=t.payloadMessage.payloadBytes,a=0;a<i.length;a++)i[a]<=15?o=o+"0"+i[a].toString(16):o+=i[a].toString(16);r.payloadMessage.payloadHex=o,r.payloadMessage.qos=t.payloadMessage.qos,r.payloadMessage.destinationName=t.payloadMessage.destinationName,t.payloadMessage.duplicate&&(r.payloadMessage.duplicate=!0),t.payloadMessage.retained&&(r.payloadMessage.retained=!0),0==e.indexOf("Sent:")&&(void 0===t.sequence&&(t.sequence=++this._sequence),r.sequence=t.sequence),W.setItem(e+this._localKey+t.messageIdentifier,JSON.stringify(r))},j.prototype.restore=function(e){var t=W.getItem(e),r=JSON.parse(t),o=new w(r.type,r);if(r.type!==n)throw Error(v(g.INVALID_STORED_DATA,[e,t]));for(var i=r.payloadMessage.payloadHex,a=new ArrayBuffer(i.length/2),s=new Uint8Array(a),c=0;i.length>=2;){var l=parseInt(i.substring(0,2),16);i=i.substring(2,i.length),s[c++]=l}var u=new J.Message(s);u.qos=r.payloadMessage.qos,u.destinationName=r.payloadMessage.destinationName,r.payloadMessage.duplicate&&(u.duplicate=!0),r.payloadMessage.retained&&(u.retained=!0),o.payloadMessage=u,0==e.indexOf("Sent:"+this._localKey)?this._sentMessages[o.messageIdentifier]=o:0==e.indexOf("Received:"+this._localKey)&&(this._receivedMessages[o.messageIdentifier]=o)},j.prototype._process_queue=function(){for(var e=null,t=this._msg_queue.reverse();e=t.pop();)this._socket_send(e),this._notify_msg_sent[e]&&(this._notify_msg_sent[e](),delete this._notify_msg_sent[e])},j.prototype._requires_ack=function(e){var t=Object.keys(this._sentMessages).length;if(t>this.maxMessageIdentifier)throw Error("Too many messages:"+t);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;e.messageIdentifier=this._message_identifier,this._sentMessages[e.messageIdentifier]=e,e.type===n&&this.store("Sent:",e),this._message_identifier===this.maxMessagIdentifier&&(this._message_identifier=1)},j.prototype._on_socket_open=function(){var e=new w(t,this.connectOptions);e.clientId=this.clientId,this._socket_send(e)},j.prototype._on_socket_message=function(e){this._trace("Client._on_socket_message",e.data),this.receivePinger.reset();var t=new Uint8Array(e.data);try{var c=function(e){var t,c=e[0],u=c>>4,f=c&=15,h=1;do{t=e[h++],128}while(0!=(128&t));var d=new w(u);switch(u){case r:d.topicNameCompressionResponse=e[h++],d.returnCode=e[h++];break;case n:var y=f>>1&3,_=C(e,h),g=T(e,h+=2,_);h+=_,y>0&&(d.messageIdentifier=C(e,h),h+=2);var m=new J.Message(e.subarray(h));1==(1&f)&&(m.retained=!0),8==(8&f)&&(m.duplicate=!0),m.qos=y,m.destinationName=g,d.payloadMessage=m;break;case o:case i:case a:case s:case p:d.messageIdentifier=C(e,h);break;case l:d.messageIdentifier=C(e,h),h+=2,d.grantedQos=e.subarray(h)}return d}(t)}catch(e){return void this._disconnected(g.INTERNAL_ERROR.code,v(g.INTERNAL_ERROR,[e.message]))}switch(this._trace("Client._on_socket_message",c),c.type){case r:if(this._connectTimeout.cancel(),this.connectOptions.cleanSession){for(var u in this._sentMessages){var f=this._sentMessages[u];W.removeItem("Sent:"+this._localKey+f.messageIdentifier)}for(var u in this._sentMessages={},this._receivedMessages){var d=this._receivedMessages[u];W.removeItem("Received:"+this._localKey+d.messageIdentifier)}this._receivedMessages={}}if(0!==c.returnCode){this._disconnected(g.CONNACK_RETURNCODE.code,v(g.CONNACK_RETURNCODE,[c.returnCode,m[c.returnCode]]));break}this.connected=!0,this.connectOptions.hosts&&(this.hostIndex=this.connectOptions.hosts.length);var y=new Array;for(var _ in this._sentMessages)this._sentMessages.hasOwnProperty(_)&&y.push(this._sentMessages[_]);for(var b=0,k=(y=y.sort((function(e,t){return e.sequence-t.sequence}))).length;b<k;b++){if((f=y[b]).type==n&&f.pubRecReceived){var S=new w(a,{messageIdentifier:f.messageIdentifier});this._schedule_message(S)}else this._schedule_message(f)}this.connectOptions.onSuccess&&this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext}),this._process_queue();break;case n:this._receivePublish(c);break;case o:(f=this._sentMessages[c.messageIdentifier])&&(delete this._sentMessages[c.messageIdentifier],W.removeItem("Sent:"+this._localKey+c.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(f.payloadMessage));break;case i:if(f=this._sentMessages[c.messageIdentifier]){f.pubRecReceived=!0;S=new w(a,{messageIdentifier:c.messageIdentifier});this.store("Sent:",f),this._schedule_message(S)}break;case a:d=this._receivedMessages[c.messageIdentifier];W.removeItem("Received:"+this._localKey+c.messageIdentifier),d&&(this._receiveMessage(d),delete this._receivedMessages[c.messageIdentifier]);var E=new w(s,{messageIdentifier:c.messageIdentifier});this._schedule_message(E);break;case s:f=this._sentMessages[c.messageIdentifier];delete this._sentMessages[c.messageIdentifier],W.removeItem("Sent:"+this._localKey+c.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(f.payloadMessage);break;case l:case p:(f=this._sentMessages[c.messageIdentifier])&&(f.timeOut&&f.timeOut.cancel(),f.callback&&f.callback(),delete this._sentMessages[c.messageIdentifier]);break;case h:this.sendPinger.reset();break;default:this._disconnected(g.INVALID_MQTT_MESSAGE_TYPE.code,v(g.INVALID_MQTT_MESSAGE_TYPE,[c.type]))}},j.prototype._on_socket_error=function(e){this._disconnected(g.SOCKET_ERROR.code,v(g.SOCKET_ERROR,[e.data]))},j.prototype._on_socket_close=function(){this._disconnected(g.SOCKET_CLOSE.code,v(g.SOCKET_CLOSE))},j.prototype._socket_send=function(e){if(1==e.type){var t=this._traceMask(e,"password");this._trace("Client._socket_send",t)}else this._trace("Client._socket_send",e);this.socket.send(e.encode()),this.sendPinger.reset()},j.prototype._receivePublish=function(e){switch(e.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(e);break;case 1:var t=new w(o,{messageIdentifier:e.messageIdentifier});this._schedule_message(t),this._receiveMessage(e);break;case 2:this._receivedMessages[e.messageIdentifier]=e,this.store("Received:",e);var r=new w(i,{messageIdentifier:e.messageIdentifier});this._schedule_message(r);break;default:throw Error("Invaild qos="+wireMmessage.payloadMessage.qos)}},j.prototype._receiveMessage=function(e){this.onMessageArrived&&this.onMessageArrived(e.payloadMessage)},j.prototype._disconnected=function(e,t){this._trace("Client._disconnected",e,t),this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&this._connectTimeout.cancel(),this._msg_queue=[],this._notify_msg_sent={},this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket),this.connectOptions.hosts&&this.hostIndex<this.connectOptions.hosts.length-1?(this.hostIndex++,this._doConnect(this.connectOptions.hosts[this.hostIndex],this.connectOptions.ports[this.hostIndex])):(void 0===e&&(e=g.OK.code,t=v(g.OK)),this.connected?(this.connected=!1,this.onConnectionLost&&this.onConnectionLost({errorCode:e,errorMessage:t})):this.connectOptions.onFailure&&this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:e,errorMessage:t}))},j.prototype._trace=function(){if(null!==this._traceBuffer)for(var e=0,t=arguments.length;e<t;e++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),0===e||void 0===arguments[e]?this._traceBuffer.push(arguments[e]):this._traceBuffer.push("  "+JSON.stringify(arguments[e]))},j.prototype._traceMask=function(e,t){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=n==t?"******":e[n]);return r};var P=function(e,t,r){if("string"!=typeof e)throw new Error(v(g.INVALID_TYPE,[E(e),"host"]));if("number"!=typeof t||t<0)throw new Error(v(g.INVALID_TYPE,[E(t),"port"]));for(var n=0,o=0;o<r.length;o++){var i=r.charCodeAt(o);55296<=i&&i<=56319&&o++,n++}if("string"!=typeof r||n<1|n>23)throw new Error(v(g.INVALID_ARGUMENT,[r,"clientId"]));var a=new j(e,t,r);this._getHost=function(){return a.host},this._setHost=function(){throw new Error(v(g.UNSUPPORTED_OPERATION))},this._getPort=function(){return a.port},this._setPort=function(){throw new Error(v(g.UNSUPPORTED_OPERATION))},this._getClientId=function(){return a.clientId},this._setClientId=function(){throw new Error(v(g.UNSUPPORTED_OPERATION))},this._getOnConnectionLost=function(){return a.onConnectionLost},this._setOnConnectionLost=function(e){if("function"!=typeof e)throw new Error(v(g.INVALID_TYPE,[E(e),"onConnectionLost"]));a.onConnectionLost=e},this._getOnMessageDelivered=function(){return a.onMessageDelivered},this._setOnMessageDelivered=function(e){if("function"!=typeof e)throw new Error(v(g.INVALID_TYPE,[E(e),"onMessageDelivered"]));a.onMessageDelivered=e},this._getOnMessageArrived=function(){return a.onMessageArrived},this._setOnMessageArrived=function(e){if("function"!=typeof e)throw new Error(v(g.INVALID_TYPE,[E(e),"onMessageArrived"]));a.onMessageArrived=e},this.connect=function(e){if(y(e=e||{},{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object"}),void 0===e.keepAliveInterval&&(e.keepAliveInterval=60),e.willMessage){if(!(e.willMessage instanceof M))throw new Error(v(g.INVALID_TYPE,[e.willMessage,"connectOptions.willMessage"]));if(e.willMessage.stringPayload,void 0===e.willMessage.destinationName)throw new Error(v(g.INVALID_TYPE,[E(e.willMessage.destinationName),"connectOptions.willMessage.destinationName"]))}if(void 0===e.cleanSession&&(e.cleanSession=!0),e.hosts){if(!e.ports)throw new Error(v(g.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(!(e.hosts instanceof Array))throw new Error(v(g.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));if(!(e.ports instanceof Array))throw new Error(v(g.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(e.hosts.length<1)throw new Error(v(g.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));if(e.hosts.length!=e.ports.length)throw new Error(v(g.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));for(var t=0;t<e.hosts.length;t++){if("string"!=typeof e.hosts[t])throw new Error(v(g.INVALID_TYPE,[E(e.hosts[t]),"connectOptions.hosts["+t+"]"]));if("number"!=typeof e.ports[t]||e.ports[t]<0)throw new Error(v(g.INVALID_TYPE,[E(e.ports[t]),"connectOptions.ports["+t+"]"]))}}a.connect(e)},this.subscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(y(t=t||{},{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("subscribeOptions.timeout specified with no onFailure callback.");if(void 0!==t.qos&&0!==t.qos&&1!==t.qos&&2!==t.qos)throw new Error(v(g.INVALID_ARGUMENT,[t.qos,"subscribeOptions.qos"]));a.subscribe(e,t)},this.unsubscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(y(t=t||{},{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("unsubscribeOptions.timeout specified with no onFailure callback.");a.unsubscribe(e,t)},this.send=function(e){if(!(e instanceof M))throw new Error("Invalid argument:"+E(e));if(void 0===e.destinationName)throw new Error("Invalid parameter Message.destinationName:"+e.destinationName);a.send(e)},this.disconnect=function(){a.disconnect()},this.getTraceLog=function(){return a.getTraceLog()},this.startTrace=function(){a.startTrace()},this.stopTrace=function(){a.stopTrace()}};P.prototype={get host(){return this._getHost()},set host(e){this._setHost(e)},get port(){return this._getPort()},set port(e){this._setPort(e)},get clientId(){return this._getClientId()},set clientId(e){this._setClientId(e)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(e){this._setOnConnectionLost(e)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(e){this._setOnMessageDelivered(e)},get onMessageArrived(){return this._getOnMessageArrived()},set onMessageArrived(e){this._setOnMessageArrived(e)}};var M=function(e){var t;if(!("string"==typeof e||e instanceof ArrayBuffer||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array))throw v(g.INVALID_ARGUMENT,[e,"newPayload"]);t=e,this._getPayloadString=function(){return"string"==typeof t?t:T(t,0,t.length)},this._getPayloadBytes=function(){if("string"==typeof t){var e=new ArrayBuffer(O(t)),r=new Uint8Array(e);return x(t,r,0),r}return t};var r=void 0;this._getDestinationName=function(){return r},this._setDestinationName=function(e){if("string"!=typeof e)throw new Error(v(g.INVALID_ARGUMENT,[e,"newDestinationName"]));r=e};var n=0;this._getQos=function(){return n},this._setQos=function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Invalid argument:"+e);n=e};var o=!1;this._getRetained=function(){return o},this._setRetained=function(e){if("boolean"!=typeof e)throw new Error(v(g.INVALID_ARGUMENT,[e,"newRetained"]));o=e};var i=!1;this._getDuplicate=function(){return i},this._setDuplicate=function(e){i=e}};return M.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(e){this._setDestinationName(e)},get qos(){return this._getQos()},set qos(e){this._setQos(e)},get retained(){return this._getRetained()},set retained(e){this._setRetained(e)},get duplicate(){return this._getDuplicate()},set duplicate(e){this._setDuplicate(e)}},{Client:P,Message:M}}(window);const Q=J;const K=function(){function e(){a(this,e)}return c(e,null,[{key:"sendMessage",value:function(e,t){$.sendMessage({request_id:166,type:3,payload:JSON.stringify({version_id:4859504530738380,tasks:[{label:"46",payload:JSON.stringify({thread_id:t,otid:Math.floor(0x5f9b38e88c7bdc00*Math.random()),source:2097153,send_type:1,text:e,initiating_source:0}),queue_name:t,task_id:160,failure_count:null},{label:"21",payload:JSON.stringify({thread_id:t,sync_group:1}),queue_name:t,task_id:161,failure_count:null}],epoch_id:Math.floor(0x5f9b38e88c7bdc00*Math.random())}),app_id:"2220391788200892"})}},{key:"toggleTypingIndicator",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];console.warn("Sent typing"),$.sendMessage({request_id:169,type:4,payload:JSON.stringify({label:"3",payload:JSON.stringify({thread_key:t,is_group_thread:r,is_typing:e,attribution:0}),version:"4626452597464997"}),app_id:"2220391788200892"})}}]),e}();var Y=function(){function e(){a(this,e)}return c(e,null,[{key:"globalCallback",value:function(e,t,r){console.error(e,t,r)}},{key:"listenMqtt",value:function(){var e=this;return new Promise(function(){var t=n(i().mark((function t(r){var o,a,s,c,l,u,f,h,d;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=Math.floor(9007199254740991*Math.random())+1,a=void 0,s=null,t.next=5,p.getCookieString("https://www.facebook.com");case 5:return c=t.sent,t.next=8,p.getCookies("https://www.facebook.com");case 8:return l=t.sent.find((function(e){return"c_user"===e.name})).value,t.next=11,b.getData("account",{});case 11:return u=t.sent,f={u:l,s:o,chat_on:e.chatOn,fg:e.foreground,d:G.getGUID(),ct:"websocket",aid:"219994525426954",mqtt_sid:"",cp:3,ecp:10,st:e.topics,pm:[],dc:"",no_auto_fg:!0,gas:null},h={host:"wss://edge-chat.facebook.com/chat?sid="+o,port:443,clientId:"mqttwsclient",protocolId:"ws",protocolVersion:3,username:JSON.stringify(f),clean:!0,wsOptions:{headers:{Cookie:c,Host:"edge-chat.facebook.com",Origin:"https://www.facebook.com",Referer:"https://www.facebook.com"},origin:"https://www.facebook.com",protocolVersion:13}},t.next=17,m.getFbDtsg();case 17:return t.sent,t.next=20,m.loadRawThreads(1);case 20:d=t.sent,s=d.message_threads.sync_sequence_id,e.mqttClient=new Q.Client(h.host,h.port,h.clientId),e.mqttClient.connect({userName:JSON.stringify(f),onSuccess:function(){var t,n={sync_api_version:10,max_deltas_able_to_process:1e3,delta_batch_size:500,encoding:"JSON",entity_fbid:l};a?(t="/messenger_sync_get_diffs",n.last_seq_id=s,n.sync_token=a):(t="/messenger_sync_create_queue",n.initial_titan_sequence_id=s,n.device_params=null);var o=new Q.Message(JSON.stringify(n));o.destinationName=t,o.qos=1,o.retained=!1,e.mqttClient.send(o),r()}}),e.mqttClient.onMessageArrived=function(){var t=n(i().mark((function t(r){var n,o,c,p,f,h,d,y,_,g,v,w,k,E,C;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=r.payloadString,o=n.destinationName,c=(new Date).getTime(),p=JSON.parse(n),console.log("Still listening..."),"typ"!==(null==p?void 0:p.type)){t.next=57;break}if(console.warn("Received typing: ",p),t.prev=8,f=u.savedTypingIndicators.find((function(e){return Number(e.id)===Number(null==p?void 0:p.sender_fbid)}))){t.next=18;break}return t.next=13,m.loadCometHoverCard(null==p?void 0:p.sender_fbid);case 13:return h=t.sent,f={id:h.id,name:h.name},u.savedTypingIndicators.push(f),t.next=18,b.setData("account",u);case 18:if(d=void 0,null==p||!p.thread){t.next=29;break}if(d=u.savedThreads.find((function(e){return Number(e.id)===Number(p.thread)}))){t.next=29;break}return t.next=24,m.loadThreadInfo(p.thread);case 24:return y=t.sent,d={id:p.thread,name:null!=y&&y.name?y.name:p.thread},u.savedThreads.push(d),t.next=29,b.setData("account",u);case 29:if(null==p||!p.thread){t.next=37;break}return t.next=32,b.getData("fakeTypingWithGroupParticipant");case 32:if(t.t0=t.sent,!t.t0){t.next=35;break}K.toggleTypingIndicator(p.state,p.thread,!0);case 35:t.next=42;break;case 37:return t.next=39,b.getData("fakeTypingWithSomeone");case 39:if(t.t1=t.sent,!t.t1){t.next=42;break}K.toggleTypingIndicator(p.state,p.sender_fbid,!1);case 42:return t.next=44,b.getData("historicTypingActs",[]);case 44:return _=t.sent,g={time:c,typingIndicator:f,threadInfo:d,state:null==p?void 0:p.state},_.push(g),t.next=49,b.setData("historicTypingActs",_);case 49:return t.next=51,S.updateHistory(g);case 51:chrome.browserAction.setIcon({path:{128:"typing-with-dot.png"}}),t.next=57;break;case 54:t.prev=54,t.t2=t.catch(8),console.error("Error occurred: ",t.t2);case 57:if("/t_ms"===o)for(v in p.firstDeltaSeqId&&p.syncToken&&(s=p.firstDeltaSeqId,a=p.syncToken),p.lastIssuedSeqId&&(s=parseInt(p.lastIssuedSeqId)),p.deltas)w=p.deltas[v],e.parseDelta(l,{delta:w});else if("/thread_typing"===o||"/orca_typing_notifications"===o)k={type:"typ",isTyping:!!p.state,from:p.sender_fbid.toString(),threadID:G.formatID((p.thread||p.sender_fbid).toString())},function(){this.globalCallback(null,k)}();else if("/orca_presence"===o)for(C in E=function(e){var t=p.list[e],r={type:"presence",userID:t.u.toString(),timestamp:1e3*t.l,statuses:t.p};!function(){this.globalCallback(null,r)}()},p.list)E(C);t.next=63;break;case 60:t.prev=60,t.t3=t.catch(0),console.log(t.t3);case 63:case"end":return t.stop()}}),t,null,[[0,60],[8,54]])})));return function(e){return t.apply(this,arguments)}}();case 25:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"stopListeningMqtt",value:function(){this.mqttClient&&(this.mqttClient.disconnect(),this.mqttClient=void 0)}},{key:"sendMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/ls_req";e="string"!=typeof e?JSON.stringify(e):e;var r=new Q.Message(e);r.destinationName=t,r.qos=1,r.retained=!1,this.mqttClient.send(r)}},{key:"parseDelta",value:function(e,t){if(console.log("------v",t),"NewMessage"===t.delta.class&&function r(n){if(t.delta.attachments&&n===t.delta.attachments.length){var o;try{o=G.formatDeltaMessage(t)}catch(e){return this.globalCallback({error:"Problem parsing message object. Please open an issue at https://github.com/Schmavery/facebook-chat-api/issues.",detail:e,res:t,type:"parse_error"})}return o.senderID===e?void 0:function(){this.globalCallback(null,o)}()}if(!t.delta.attachments||"photo"!==t.delta.attachments[n].mercury.attach_type)return r(n+1)}(0),"ClientPayload"===t.delta.class){var r=G.decodeClientPayload(t.delta.payload);if(r&&r.deltas){var n=function(t){var n=r.deltas[t];if(n.deltaMessageReaction)!function(){this.globalCallback(null,{type:"message_reaction",threadID:(n.deltaMessageReaction.threadKey.threadFbId?n.deltaMessageReaction.threadKey.threadFbId:n.deltaMessageReaction.threadKey.otherUserFbId).toString(),messageID:n.deltaMessageReaction.messageId,reaction:n.deltaMessageReaction.reaction,senderID:n.deltaMessageReaction.senderId.toString(),userID:n.deltaMessageReaction.userId.toString()})}();else if(n.deltaRecallMessageData)!function(){this.globalCallback(null,{type:"message_unsend",threadID:(n.deltaRecallMessageData.threadKey.threadFbId?n.deltaRecallMessageData.threadKey.threadFbId:n.deltaRecallMessageData.threadKey.otherUserFbId).toString(),messageID:n.deltaRecallMessageData.messageID,senderID:n.deltaRecallMessageData.senderID.toString(),deletionTimestamp:n.deltaRecallMessageData.deletionTimestamp,timestamp:n.deltaRecallMessageData.timestamp})}();else if(n.deltaMessageReply){for(var o=void 0===n.deltaMessageReply.message||void 0===n.deltaMessageReply.message.data||void 0===n.deltaMessageReply.message.data.prng?[]:JSON.parse(n.deltaMessageReply.message.data.prng),i=o.map((function(e){return e.i})),a=o.map((function(e){return e.o})),s=o.map((function(e){return e.l})),c={},l=0;l<i.length;l++)c[i[l]]=(n.deltaMessageReply.message.body||"").substring(a[l],a[l]+s[l]);var u={type:"message_reply",threadID:(n.deltaMessageReply.message.messageMetadata.threadKey.threadFbId?n.deltaMessageReply.message.messageMetadata.threadKey.threadFbId:n.deltaMessageReply.message.messageMetadata.threadKey.otherUserFbId).toString(),messageID:n.deltaMessageReply.message.messageMetadata.messageId,senderID:n.deltaMessageReply.message.messageMetadata.actorFbId.toString(),attachments:n.deltaMessageReply.message.attachments.map((function(e){var t=JSON.parse(e.mercuryJSON);return Object.assign(e,t),e})).map((function(e){var t;try{t=G._formatAttachment(e)}catch(r){(t=e).error=r,t.type="unknown"}return t})),body:n.deltaMessageReply.message.body||"",isGroup:!!n.deltaMessageReply.message.messageMetadata.threadKey.threadFbId,mentions:c,timestamp:n.deltaMessageReply.message.messageMetadata.timestamp};if(n.deltaMessageReply.repliedToMessage){i=(o=void 0===n.deltaMessageReply.repliedToMessage||void 0===n.deltaMessageReply.repliedToMessage.data||void 0===n.deltaMessageReply.repliedToMessage.data.prng?[]:JSON.parse(n.deltaMessageReply.repliedToMessage.data.prng)).map((function(e){return e.i})),a=o.map((function(e){return e.o})),s=o.map((function(e){return e.l}));for(var p={},f=0;f<i.length;f++)p[i[f]]=(n.deltaMessageReply.repliedToMessage.body||"").substring(a[f],a[f]+s[f]);u.messageReply={threadID:(n.deltaMessageReply.repliedToMessage.messageMetadata.threadKey.threadFbId?n.deltaMessageReply.repliedToMessage.messageMetadata.threadKey.threadFbId:n.deltaMessageReply.repliedToMessage.messageMetadata.threadKey.otherUserFbId).toString(),messageID:n.deltaMessageReply.repliedToMessage.messageMetadata.messageId,senderID:n.deltaMessageReply.repliedToMessage.messageMetadata.actorFbId.toString(),attachments:n.deltaMessageReply.repliedToMessage.attachments.map((function(e){var t=JSON.parse(e.mercuryJSON);return Object.assign(e,t),e})).map((function(e){var t;try{t=G._formatAttachment(e)}catch(r){(t=e).error=r,t.type="unknown"}return t})),body:n.deltaMessageReply.repliedToMessage.body||"",isGroup:!!n.deltaMessageReply.repliedToMessage.messageMetadata.threadKey.threadFbId,mentions:p,timestamp:n.deltaMessageReply.repliedToMessage.messageMetadata.timestamp}}return{v:u.senderID===e?void 0:function(){this.globalCallback(null,u)}()}}};for(var o in r.deltas){var i=n(o);if("object"===E(i))return i.v}return}}switch(t.delta.class){case"ReadReceipt":var a;try{a=G.formatDeltaReadReceipt(t.delta)}catch(e){return this.globalCallback({error:"Problem parsing message object. Please open an issue at https://github.com/Schmavery/facebook-chat-api/issues.",detail:e,res:t.delta,type:"parse_error"})}return function(){this.globalCallback(null,a)}();case"AdminTextMessage":switch(t.delta.type){case"change_thread_theme":case"change_thread_nickname":case"change_thread_icon":break;case"group_poll":var s;try{s=G.formatDeltaEvent(t.delta)}catch(e){return this.globalCallback({error:"Problem parsing message object. Please open an issue at https://github.com/Schmavery/facebook-chat-api/issues.",detail:e,res:t.delta,type:"parse_error"})}return function(){this.globalCallback(null,s)}();default:return}break;case"ThreadName":case"ParticipantsAddedToGroupThread":case"ParticipantLeftGroupThread":try{G.formatDeltaEvent(t.delta)}catch(e){return this.globalCallback({error:"Problem parsing message object. Please open an issue at https://github.com/Schmavery/facebook-chat-api/issues.",detail:e,res:t.delta,type:"parse_error"})}return}}}]),e}();e(Y,"userAgent","Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.81 Safari/537.36"),e(Y,"chatOn",!0),e(Y,"foreground",!1),e(Y,"log",console),e(Y,"mqttClient",void 0),e(Y,"topics",["/t_ms","/thread_typing","/orca_typing_notifications","/orca_presence","/legacy_web","/ls_resp","/br_sr","/sr_res","/webrtc","/onevc","/notify_disconnect","/inbox","/mercury","/messaging_events","/orca_message_notifications","/pp","/webrtc_response"]);const $=Y;function z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function X(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?z(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}S.startup().then(n(i().mark((function e(){var t,r,n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S.isLoggedIn){e.next=3;break}return console.log("not login"),e.abrupt("return",!1);case 3:return _.setupBlockers(),e.next=6,b.getData("account",{});case 6:return t=e.sent,e.next=9,p.getFacebookCredentials();case 9:return r=e.sent,console.log(r),n=null!=t&&t.savedTypingIndicators?t.savedTypingIndicators:[],o=null!=t&&t.savedThreads?t.savedThreads:[],S.account=r,e.next=16,b.setData("account",X(X({},r),{},{savedTypingIndicators:n,savedThreads:o}));case 16:return console.log("connecting..."),e.next=19,$.listenMqtt();case 19:console.log("connected"),console.log("start listening to typing events...");case 21:case"end":return e.stop()}}),e)})))),chrome.cookies.onChanged.addListener((function(e){if(".facebook.com"===e.cookie.domain){if("xs"===e.cookie.name&&!e.removed)return;if("c_user"===e.cookie.name&&Number(e.cookie.value)===Number(S.currentUID))return;if("xs"!==e.cookie.name&&"c_user"!==e.cookie.name)return;chrome.runtime.reload()}}))})()})();